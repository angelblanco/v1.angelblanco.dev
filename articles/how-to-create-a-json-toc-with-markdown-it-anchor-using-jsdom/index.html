<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <base href=/ > <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <title>How to create a JSON table of contents with markdown-it and markdown-it-anchor - Angel Blanco's blog</title><meta content="Steps by step guide parse your markdown's HTML at compile stage using node and jsdom with full github repository." data-svelte=svelte-1xb68rj name=description><meta content=https://angelblanco.dev/articles/how-to-create-a-json-toc-with-markdown-it-anchor-using-jsdom/ data-svelte=svelte-1xb68rj property=og:url><meta content="How to create a JSON table of contents with markdown-it and markdown-it-anchor" data-svelte=svelte-1xb68rj property=og:title><meta content="Steps by step guide parse your markdown's HTML at compile stage using node and jsdom with full github repository." data-svelte=svelte-1xb68rj property=og:description><meta content=https://angelblanco.dev/images/share-default.png data-svelte=svelte-1xb68rj property=og:image><meta content=1200 data-svelte=svelte-1xb68rj property=og:image:width><meta content=630 data-svelte=svelte-1xb68rj property=og:image:height><meta content=en_US data-svelte=svelte-1xb68rj property=og:locale><meta content="Ángel Blanco" data-svelte=svelte-1xb68rj property=og:author><meta content="How to create a JSON table of contents with markdown-it and markdown-it-anchor" data-svelte=svelte-1xb68rj name=twitter:title><meta content="Steps by step guide parse your markdown's HTML at compile stage using node and jsdom with full github repository." data-svelte=svelte-1xb68rj name=twitter:description><meta content=summary_large_image data-svelte=svelte-1xb68rj name=twitter:card><meta content=@angelblancodev data-svelte=svelte-1xb68rj name=twitter:site><meta content=@angelblancodev data-svelte=svelte-1xb68rj name=twitter:creator><meta content=https://angelblanco.dev/images/share-default.png data-svelte=svelte-1xb68rj name=twitter:image> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,{},(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){return {article:{id:a,type:"article",tweet:b,slug:c,url:d,title:e,intro:"\u003Cp\u003EThere are some plugins to create a table of content using markdown-it, but sometimes you want to create a custom component for rendering your TOC.\u003C\u002Fp\u003E\n\u003Cp\u003EHere a simple example on how to get the table of content's tree with vanilla javascript without writing any markdown-it plugin.\u003C\u002Fp\u003E\n\u003Cpre class=\"terminal gnome-terminal-image-container\"\u003E\u003Cdiv class=\"bar\"\u003E\u003Cdiv class=\"btn\"\u003E\u003C\u002Fdiv\u003E\u003Cdiv class=\"bar-title\"\u003Ebash\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cdiv class=\"body\"\u003E\u003Cdiv class=\"image\"\u003E\u003Cimg alt=\"o\" src=\"https:\u002F\u002Fraw.githubusercontent.com\u002Fangelblanco\u002Fdemo-markdown-it-anchor-toc-jsdom\u002Fmaster\u002Fdemo.gif\"\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003C\u002Fpre\u003E",description:f,tags:[g,h,i],date:"September 18, 2020",readingTimeText:j,readingTimeMinutes:k,words:l,note:false,shortLink:"\u002Fgo\u002FYS0y",toc:{tree:[{level:a,title:m,anchor:n,children:[]},{level:a,title:o,anchor:p,children:[]},{level:a,title:q,anchor:r,children:[]},{level:a,title:s,anchor:t,children:[]},{level:a,title:u,anchor:v,children:[]}],plain:[{level:a,title:m,anchor:n},{level:a,title:o,anchor:p},{level:a,title:q,anchor:r},{level:a,title:s,anchor:t},{level:a,title:u,anchor:v}]},meta:{id:a,date:"2020-09-18T00:00:00.000Z",tweet:b,title:e,description:f,intro:"There are some plugins to create a table of content using markdown-it, but sometimes you want to create a custom component for rendering your TOC.\n\nHere a simple example on how to get the table of content's tree with vanilla javascript without writing any markdown-it plugin.\n\n::: gnome-terminal-image \"demo\" \"https:\u002F\u002Fraw.githubusercontent.com\u002Fangelblanco\u002Fdemo-markdown-it-anchor-toc-jsdom\u002Fmaster\u002Fdemo.gif\"\n",tags:[g,h,i],published:true,slug:c,titleSlug:"how-to-create-a-json-table-of-contents-with-markdown-it-and-markdown-it-anchor",readingStats:{text:j,minutes:k,time:244800,words:l}},html:"\u003Ch2 id=\"basic-markdown-it-setup\"\u003EBasic markdown it setup\u003C\u002Fh2\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003EIf you want to skip this process and run the demo on your personal computer you can clone the demo repository on Github\u003C\u002Fp\u003E\n\u003Cdiv class=\"github-link-container\"\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fangelblanco\u002Fdemo-markdown-it-anchor-toc-jsdom\" target=\"__blank\" class=\"button is-medium\"\u003E\u003Cspan class=\"icon\"\u003E\u003Ci class=\"fab fa-github\"\u003E\u003C\u002Fi\u003E\u003C\u002Fspan\u003E\u003Cspan\u003EClone the demo of this article on Github\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003C\u002Fdiv\u003E\u003C\u002Fblockquote\u003E\n\u003Cp\u003EOn your javascript application, we want to install some dependencies first.\u003C\u002Fp\u003E\n\u003Cpre class=\"terminal\"\u003E\n  \u003Cdiv class=\"bar bar-language-bash\"\u003E\n    \u003Cdiv class=\"btn\"\u003E\u003C\u002Fdiv\u003E\n    \u003Cdiv class=\"bar-title\"\u003Ebash\u003C\u002Fdiv\u003E\n    \u003Cdiv\u003E\u003Cbutton class=\"button copy is-small is-pulled-right\"\u003ECopy\u003C\u002Fbutton\u003E\u003C\u002Fdiv\u003E  \n  \u003C\u002Fdiv\u003E\n  \u003Cdiv class=\"body\"\u003E\u003Cpre class=\"language-bash\"\u003E\u003Ccode\u003E\u003Cspan class=\"hl--token hl--function\"\u003Eyarn\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--function\"\u003Eadd\u003C\u002Fspan\u003E --dev markdown-it markdown-it-anchor\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n  \u003C\u002Fpre\u003E\n\u003Cp\u003ENow let's convert some simple markdown to Html:\u003C\u002Fp\u003E\n\u003Cpre class=\"terminal\"\u003E\n  \u003Cdiv class=\"bar bar-language-javascript\"\u003E\n    \u003Cdiv class=\"btn\"\u003E\u003C\u002Fdiv\u003E\n    \u003Cdiv class=\"bar-title\"\u003Ejavascript\u003C\u002Fdiv\u003E\n    \u003Cdiv\u003E\u003Cbutton class=\"button copy is-small is-pulled-right\"\u003ECopy\u003C\u002Fbutton\u003E\u003C\u002Fdiv\u003E  \n  \u003C\u002Fdiv\u003E\n  \u003Cdiv class=\"body\"\u003E\u003Cpre class=\"language-javascript\"\u003E\u003Ccode\u003E\u003Cspan class=\"hl--token hl--comment\"\u003E\u002F\u002F demo.js\u003C\u002Fspan\u003E\n\u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--maybe-class-name\"\u003EMarkdownIt\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--function\"\u003Erequire\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E'markdown-it'\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E md \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--class-name\"\u003EMarkdownIt\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Euse\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--function\"\u003Erequire\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E\"markdown-it-anchor\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E markdownText \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--template-string\"\u003E\u003Cspan class=\"hl--token hl--template-punctuation hl--string\"\u003E`\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E\n# First header\nSome content\n\n## Second-level header\nMore content\n### Third level header\n## Another second-level header\n\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--template-punctuation hl--string\"\u003E`\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E html \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E md\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Erender\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003EmarkdownText\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hl--token hl--console hl--class-name\"\u003Econsole\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E html \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n  \u003C\u002Fpre\u003E\n\u003Ch2 id=\"plain-table-of-content\"\u003EPlain table of content\u003C\u002Fh2\u003E\n\u003Cp\u003EThe first approach will be to create a plain TOC, that returns a one level array with the title, the anchor, and the associated level. Using this type of TOC could give you a really clear component, avoiding the extra complexity of recursion.\u003C\u002Fp\u003E\n\u003Cpre class=\"terminal\"\u003E\n  \u003Cdiv class=\"bar bar-language-javascript\"\u003E\n    \u003Cdiv class=\"btn\"\u003E\u003C\u002Fdiv\u003E\n    \u003Cdiv class=\"bar-title\"\u003Ejavascript\u003C\u002Fdiv\u003E\n    \u003Cdiv\u003E\u003Cbutton class=\"button copy is-small is-pulled-right\"\u003ECopy\u003C\u002Fbutton\u003E\u003C\u002Fdiv\u003E  \n  \u003C\u002Fdiv\u003E\n  \u003Cdiv class=\"body\"\u003E\u003Cpre class=\"language-javascript\"\u003E\u003Ccode\u003E\u003Cspan class=\"hl--token hl--keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--function\"\u003EcreatePlainToc\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--parameter\"\u003EdomElement\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E headers \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--known-class-name hl--class-name\"\u003EArray\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--keyword hl--module\"\u003Efrom\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003EdomElement\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003EquerySelectorAll\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E'h1, h2, h3, h4, h5, h6, h7'\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"hl--token hl--comment\"\u003E\u002F\u002F This will create a plain array with the level, the anchor and the header title\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Ereturn\u003C\u002Fspan\u003E headers\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Emap\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--parameter\"\u003Eheader\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--arrow hl--operator\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n        level\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--function\"\u003EparseInt\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003Eheader\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003EtagName\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--number\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--number\"\u003E10\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E\n        title\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E header\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003EtextContent\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E\n        anchor\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E'#'\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E+\u003C\u002Fspan\u003E header\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003EgetAttribute\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E'id'\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n  \u003C\u002Fpre\u003E\n\u003Cp\u003EUsing the above markdown text, it will return us the following output:\u003C\u002Fp\u003E\n\u003Cpre class=\"terminal\"\u003E\n  \u003Cdiv class=\"bar bar-language-javascript\"\u003E\n    \u003Cdiv class=\"btn\"\u003E\u003C\u002Fdiv\u003E\n    \u003Cdiv class=\"bar-title\"\u003Ejavascript\u003C\u002Fdiv\u003E\n    \u003Cdiv\u003E\u003Cbutton class=\"button copy is-small is-pulled-right\"\u003ECopy\u003C\u002Fbutton\u003E\u003C\u002Fdiv\u003E  \n  \u003C\u002Fdiv\u003E\n  \u003Cdiv class=\"body\"\u003E\u003Cpre class=\"language-javascript\"\u003E\u003Ccode\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E[\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E level\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--number\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E title\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E'First header'\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E anchor\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E'#first-header'\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E level\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--number\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E title\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E'Second level header'\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003Eanchor\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E'#second-level-header'\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E level\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--number\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E title\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E'Third level header'\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E anchor\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E'#third-level-header'\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E level\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--number\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E title\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E'Another second level header'\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E anchor\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E'#another-second-level-header'\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"hl--token hl--punctuation\"\u003E]\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n  \u003C\u002Fpre\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003EAlternatively you can test the above function with this page itself. You can copy the function and run\nthe following code on the browser's console\u003C\u002Fp\u003E\n\u003Cpre class=\"terminal\"\u003E\n  \u003Cdiv class=\"bar bar-language-javascript\"\u003E\n    \u003Cdiv class=\"btn\"\u003E\u003C\u002Fdiv\u003E\n    \u003Cdiv class=\"bar-title\"\u003Ejavascript\u003C\u002Fdiv\u003E\n    \u003Cdiv\u003E\u003Cbutton class=\"button copy is-small is-pulled-right\"\u003ECopy\u003C\u002Fbutton\u003E\u003C\u002Fdiv\u003E  \n  \u003C\u002Fdiv\u003E\n  \u003Cdiv class=\"body\"\u003E\u003Cpre class=\"language-javascript\"\u003E\u003Ccode\u003E\u003Cspan class=\"hl--token hl--console hl--class-name\"\u003Econsole\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--known-class-name hl--class-name\"\u003EJSON\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Estringify\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--function\"\u003EcreatePlainToc\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Ewindow\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Edocument\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003EquerySelector\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E'.articleBody'\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n  \u003C\u002Fpre\u003E\n\u003C\u002Fblockquote\u003E\n\u003Ch2 id=\"tree-table-of-content\"\u003ETree table of content\u003C\u002Fh2\u003E\n\u003Cp\u003EMost of the time we will be interested in creating a tree representation of the data.\nIn this way, we can create a recursive component that runs through the tree. We can reuse our previous function and build the data using a stack and tacking advantage of object references in Javascript. We must perform two validations:\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003EWe force all root nodes to have the same level, but not a minimum one.\u003C\u002Fli\u003E\n\u003Cli\u003EWe force all children nodes to have the parent's level + 1.\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cpre class=\"terminal\"\u003E\n  \u003Cdiv class=\"bar bar-language-javascript\"\u003E\n    \u003Cdiv class=\"btn\"\u003E\u003C\u002Fdiv\u003E\n    \u003Cdiv class=\"bar-title\"\u003Ejavascript\u003C\u002Fdiv\u003E\n    \u003Cdiv\u003E\u003Cbutton class=\"button copy is-small is-pulled-right\"\u003ECopy\u003C\u002Fbutton\u003E\u003C\u002Fdiv\u003E  \n  \u003C\u002Fdiv\u003E\n  \u003Cdiv class=\"body\"\u003E\u003Cpre class=\"language-javascript\"\u003E\u003Ccode\u003E\u003Cspan class=\"hl--token hl--keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--function\"\u003EcreateTreeToc\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--parameter\"\u003EdomElement\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E throwOnNotTree \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--boolean\"\u003Etrue\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E treeItems \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--function\"\u003EcreatePlainToc\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003EdomElement\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Emap\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--parameter\"\u003Eitem\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--arrow hl--operator\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--spread hl--operator\"\u003E...\u003C\u002Fspan\u003Eitem\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E children\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E tree \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E stack \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n    treeItems\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003EforEach\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--parameter\"\u003Eitem\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--arrow hl--operator\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hl--token hl--keyword\"\u003Elet\u003C\u002Fspan\u003E parentItem \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword hl--null hl--nil\"\u003Enull\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Edo\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n            parentItem \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E stack\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Epop\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Ewhile\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003EparentItem \u003Cspan class=\"hl--token hl--operator\"\u003E&amp;&amp;\u003C\u002Fspan\u003E parentItem\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Elevel\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E\u003E=\u003C\u002Fspan\u003E item\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Elevel\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n        \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--operator\"\u003E!\u003C\u002Fspan\u003EparentItem\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n            \u003Cspan class=\"hl--token hl--comment\"\u003E\u002F\u002F All nodes in tree[] must have the same level. \u003C\u002Fspan\u003E\n            \u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E prevTreeItem \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E tree\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Epop\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n            \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003EprevTreeItem\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n                \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003EthrowOnNotTree \u003Cspan class=\"hl--token hl--operator\"\u003E&amp;&amp;\u003C\u002Fspan\u003E item\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Elevel\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E!==\u003C\u002Fspan\u003E prevTreeItem\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Elevel\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Ethrow\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--class-name\"\u003EError\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--template-string\"\u003E\u003Cspan class=\"hl--token hl--template-punctuation hl--string\"\u003E`\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003ERoot titles dont have same level on: \"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--interpolation\"\u003E\u003Cspan class=\"hl--token hl--interpolation-punctuation hl--punctuation\"\u003E${\u003C\u002Fspan\u003Eitem\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Etitle\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--interpolation-punctuation hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--template-punctuation hl--string\"\u003E`\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n                \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\n\n                tree\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Epush\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003EprevTreeItem\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n            \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\n\n            tree\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Epush\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003Eitem\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n            stack\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Epush\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003Eitem\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n            \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003EthrowOnNotTree \u003Cspan class=\"hl--token hl--operator\"\u003E&amp;&amp;\u003C\u002Fspan\u003E parentItem\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Elevel\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E!==\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003Eitem\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Elevel\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--number\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n                \u003Cspan class=\"hl--token hl--comment\"\u003E\u002F\u002F All nodes in tree[] must have the same level. \u003C\u002Fspan\u003E\n                \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Ethrow\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--class-name\"\u003EError\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\n                    \u003Cspan class=\"hl--token hl--template-string\"\u003E\u003Cspan class=\"hl--token hl--template-punctuation hl--string\"\u003E`\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003EThe title \"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--interpolation\"\u003E\u003Cspan class=\"hl--token hl--interpolation-punctuation hl--punctuation\"\u003E${\u003C\u002Fspan\u003Eitem\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Etitle\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--interpolation-punctuation hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E\" is not a direct children of its parent\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--template-punctuation hl--string\"\u003E`\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\n                \u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n            \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\n\n            stack\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Epush\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003EparentItem\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n            stack\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Epush\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003Eitem\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n            parentItem\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Echildren\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Epush\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003Eitem\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Ereturn\u003C\u002Fspan\u003E tree\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n  \u003C\u002Fpre\u003E\n\u003Cp\u003EUsing the previous markdown we will have a well-defined tree for each top-level header and their associated children.\u003C\u002Fp\u003E\n\u003Cpre class=\"terminal\"\u003E\n  \u003Cdiv class=\"bar bar-language-javascript\"\u003E\n    \u003Cdiv class=\"btn\"\u003E\u003C\u002Fdiv\u003E\n    \u003Cdiv class=\"bar-title\"\u003Ejavascript\u003C\u002Fdiv\u003E\n    \u003Cdiv\u003E\u003Cbutton class=\"button copy is-small is-pulled-right\"\u003ECopy\u003C\u002Fbutton\u003E\u003C\u002Fdiv\u003E  \n  \u003C\u002Fdiv\u003E\n  \u003Cdiv class=\"body\"\u003E\u003Cpre class=\"language-javascript\"\u003E\u003Ccode\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E[\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n    level\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--number\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E\n    title\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E'First header'\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E\n    anchor\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E'#first-header'\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E\n    children\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E[\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n        level\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--number\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E\n        title\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E'Second level header'\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E\n        anchor\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E'#second-level-header'\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E\n        children\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E[\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E level\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--number\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E title\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E'Third level header'\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E anchor\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E'#third-level-header'\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E children\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hl--token hl--punctuation\"\u003E]\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n        level\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--number\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E\n        title\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E'Another second level header'\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E\n        anchor\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E'#another-second-level-header'\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E\n        children\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E]\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--punctuation\"\u003E]\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"hl--token hl--punctuation\"\u003E]\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n  \u003C\u002Fpre\u003E\n\u003Cp\u003EOf course opening the dev tools you can paste the previous functions, an test it with this page!\u003C\u002Fp\u003E\n\u003Cpre class=\"terminal\"\u003E\n  \u003Cdiv class=\"bar bar-language-javascript\"\u003E\n    \u003Cdiv class=\"btn\"\u003E\u003C\u002Fdiv\u003E\n    \u003Cdiv class=\"bar-title\"\u003Ejavascript\u003C\u002Fdiv\u003E\n    \u003Cdiv\u003E\u003Cbutton class=\"button copy is-small is-pulled-right\"\u003ECopy\u003C\u002Fbutton\u003E\u003C\u002Fdiv\u003E  \n  \u003C\u002Fdiv\u003E\n  \u003Cdiv class=\"body\"\u003E\u003Cpre class=\"language-javascript\"\u003E\u003Ccode\u003E\u003Cspan class=\"hl--token hl--console hl--class-name\"\u003Econsole\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--known-class-name hl--class-name\"\u003EJSON\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Estringify\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--function\"\u003EcreateTreeToc\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Ewindow\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Edocument\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003EquerySelector\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E'.articleBody'\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E \n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n  \u003C\u002Fpre\u003E\n\u003Ch2 id=\"create-the-tables-of-content-on-the-server-side-with-jsdom\"\u003ECreate the tables of content on the server-side with jsdom\u003C\u002Fh2\u003E\n\u003Cp\u003EIf you want to create the TOC on your node server or at the moment of compiling your markdown files, we can reuse our functions by installing \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fjsdom\u002Fjsdom\" target=\"_blank\"\u003Ejsdom\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Cpre class=\"terminal\"\u003E\n  \u003Cdiv class=\"bar bar-language-bash\"\u003E\n    \u003Cdiv class=\"btn\"\u003E\u003C\u002Fdiv\u003E\n    \u003Cdiv class=\"bar-title\"\u003Ebash\u003C\u002Fdiv\u003E\n    \u003Cdiv\u003E\u003Cbutton class=\"button copy is-small is-pulled-right\"\u003ECopy\u003C\u002Fbutton\u003E\u003C\u002Fdiv\u003E  \n  \u003C\u002Fdiv\u003E\n  \u003Cdiv class=\"body\"\u003E\u003Cpre class=\"language-bash\"\u003E\u003Ccode\u003E\u003Cspan class=\"hl--token hl--function\"\u003Eyarn\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--function\"\u003Eadd\u003C\u002Fspan\u003E --dev jsdom\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n  \u003C\u002Fpre\u003E\n\u003Cp\u003EAs the Html will be the hole markdown file we can create the table of content for the whole \u003Ccode\u003Ewindow.document\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Cpre class=\"terminal\"\u003E\n  \u003Cdiv class=\"bar bar-language-javascript\"\u003E\n    \u003Cdiv class=\"btn\"\u003E\u003C\u002Fdiv\u003E\n    \u003Cdiv class=\"bar-title\"\u003Ejavascript\u003C\u002Fdiv\u003E\n    \u003Cdiv\u003E\u003Cbutton class=\"button copy is-small is-pulled-right\"\u003ECopy\u003C\u002Fbutton\u003E\u003C\u002Fdiv\u003E  \n  \u003C\u002Fdiv\u003E\n  \u003Cdiv class=\"body\"\u003E\u003Cpre class=\"language-javascript\"\u003E\u003Ccode\u003E\u003Cspan class=\"hl--token hl--comment\"\u003E\u002F\u002F Asuming that html is the rendered markdown with html and nothing else.\u003C\u002Fspan\u003E\n\u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E domElement \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--class-name\"\u003Ejsdom\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003EJSDOM\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003Ehtml\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Ewindow\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Edocument\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E toc \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--function\"\u003EcreateTreeToc\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003EdomElement\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hl--token hl--console hl--class-name\"\u003Econsole\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--known-class-name hl--class-name\"\u003EJSON\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Estringify\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003Etoc\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E \n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n  \u003C\u002Fpre\u003E\n\u003Cp\u003EUsing this last approach its how I set up a simple demo on Github.\u003C\u002Fp\u003E\n\u003Cdiv class=\"github-link-container\"\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fangelblanco\u002Fdemo-markdown-it-anchor-toc-jsdom\" target=\"__blank\" class=\"button is-medium\"\u003E\u003Cspan class=\"icon\"\u003E\u003Ci class=\"fab fa-github\"\u003E\u003C\u002Fi\u003E\u003C\u002Fspan\u003E\u003Cspan\u003EClone the demo of this article on Github\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003C\u002Fdiv\u003E\u003Ch2 id=\"conclusion\"\u003EConclusion\u003C\u002Fh2\u003E\n\u003Cp\u003EUsing \u003Ccode\u003Ejsdom\u003C\u002Fcode\u003E to parse the whole HTML file to get the table of content might look like an overhead. However, doing this stuff at\nyour javascript compile stage will get you the fastest loading times for your web because it could be server-side rendered. On the other hand,\nif you parse your TOC in the browser you could access all the DOM elements on the web and not only the markdown ones.\u003C\u002Fp\u003E\n\u003Cp\u003EThank you very much for your time. Hope to see you again 🚀\u003C\u002Fp\u003E\n"},path:d}}(2,"1311016921006059527","how-to-create-a-json-toc-with-markdown-it-anchor-using-jsdom","\u002Farticles\u002Fhow-to-create-a-json-toc-with-markdown-it-anchor-using-jsdom\u002F","How to create a JSON table of contents with markdown-it and markdown-it-anchor","Steps by step guide parse your markdown's HTML at compile stage using node and jsdom with full github repository.","js","node","github","5 min read",4.08,816,"Basic markdown it setup","#basic-markdown-it-setup","Plain table of content","#plain-table-of-content","Tree table of content","#tree-table-of-content","Create the tables of content on the server-side with jsdom","#create-the-tables-of-content-on-the-server-side-with-jsdom","Conclusion","#conclusion"))]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.7ad65b9c.js"}catch(e){main="/client/legacy/client.3bbe8702.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@2.0.4.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> <link href=client/client-cf7cacb2.css rel=stylesheet><link href=client/TinyLetterSubscribeForm-818d548a.css rel=stylesheet><link href=client/[slug]-f01695a6.css rel=stylesheet> <link href=/client/client.7ad65b9c.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/client-cf7cacb2.css rel=preload as=style><link href=/client/[slug].88a925b2.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/Content.780f446a.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/Head.0f6b30e5.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/Tags.a1ae7601.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/TinyLetterSubscribeForm.1a41bbba.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/inject_styles.5607aec6.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/TinyLetterSubscribeForm-818d548a.css rel=preload as=style><link href=/client/[slug]-f01695a6.css rel=preload as=style></head> <body> <div id=sapper> <nav aria-label="main navigation" class="is-hidden-print container navbar" role=navigation><div class=navbar-brand><a href=/ class="navbar-item svelte-1qp23hj"><div class="image is-24x24" style=margin-right:10px><img alt="Angel Blanco's blog" src=/images/me-128x128.jpeg class=is-rounded></div> <img alt=logo src=/logo.png height=24 width=160></a> <span class="burger navbar-burger" aria-expanded=false aria-label=menu data-target=navbarBasicExample role=button><span aria-hidden=true></span> <span aria-hidden=true></span> <span aria-hidden=true></span></span></div> <div class=navbar-menu><div class=navbar-end><a href=articles/ class="navbar-item svelte-1qp23hj is-primary is-active" rel=prefetch>Articles </a> <a href=about/ class="navbar-item svelte-1qp23hj is-primary" rel=prefecth>About </a> <a href=https://github.com/angelblanco class="navbar-item svelte-1qp23hj" target=__blank><span class="icon is-hidden-touch"><i class="fab fa-lg fa-github-alt"></i></span> <span class=is-hidden-desktop>Github</span></a></div></div></nav> <div class="is-hidden-print back-to-top hidden svelte-1d29tie"><span class="icon is-large"><i class="fas fa-2x fa-chevron-up svelte-1d29tie"></i></span></div> <main class=blog><div class=container> <section class="reading-width section pb-0"><article class=media><figure class=media-left><a href=/about/ class="image is-64x64" rel=prefecth><img alt=user src=/images/me-128x128.jpeg class=is-rounded></a></figure> <div class=media-content><div class=container><p><a href=/about/ rel=prefetch><strong>Ángel Blanco</strong></a> <span class="has-text-grey-light is-size-7 date-subtitle svelte-ys8pd">2020-09-18 · 5 min read</span></p> <p>Tagged in:</div> <div class=tags><a href=/tag/js/ class="tag is-light js" rel=prefetch>Javascript</a><a href=/tag/node/ class="tag is-light node" rel=prefetch>Node JS</a><a href=/tag/github/ class="tag is-light github" rel=prefetch>Articles with Github code</a></div></div> <div class=media-right><a href=https://twitter.com/angelblancodev/status/1311016921006059527 class="icon is-large tweet-link" target=__blank><i class="fab fa-lg fa-twitter"></i></a></div></article></section> <div class="hidden nprogress svelte-8m52ta" style="transition:opacity .3s linear"><div class="bar svelte-8m52ta" style="margin-left:-100%;transition:all .3s linear"></div></div> <div class="svelte-1uubpsp article-sidebar-overlay hidden"><div class="svelte-1uubpsp reading-width section"><div class="svelte-1uubpsp sidebar"><div class="svelte-1uubpsp has-text-align-left social-icons"><div class=is-clearfix><a href="https://twitter.com/intent/tweet?url=https://angelblanco.dev/articles/how-to-create-a-json-toc-with-markdown-it-anchor-using-jsdom/&text=How%20to%20create%20a%20JSON%20table%20of%20contents%20with%20markdown-it%20and%20markdown-it-anchor&via=angelblancodev" class="is-small button svelte-1uubpsp" target=__blank><span class="is-small icon svelte-1uubpsp"><i class="svelte-1uubpsp fab fa-twitter"></i></span> <span>Share on Twitter</span></a> </div><div class=is-clearfix><a href="https://wwww.facebook.com/sharer.php?u=https://angelblanco.dev/articles/how-to-create-a-json-toc-with-markdown-it-anchor-using-jsdom/&t=How%20to%20create%20a%20JSON%20table%20of%20contents%20with%20markdown-it%20and%20markdown-it-anchor" class="is-small button svelte-1uubpsp" target=__blank><span class="is-small icon svelte-1uubpsp"><i class="svelte-1uubpsp fab fa-facebook"></i></span> <span>Share on Facebook</span></a> </div><div class=is-clearfix><a href="https://www.linkedin.com/sharing/share-offsite/?url=https://angelblanco.dev/articles/how-to-create-a-json-toc-with-markdown-it-anchor-using-jsdom/" class="is-small button svelte-1uubpsp" target=__blank><span class="is-small icon svelte-1uubpsp"><i class="svelte-1uubpsp fab fa-linkedin-in"></i></span> <span>Share on Linkedin</span></a> </div> <div class=is-clearfix><button class="is-small button svelte-1uubpsp"><span class="is-small icon svelte-1uubpsp"><i class="svelte-1uubpsp fas fa-comments"></i></span> <span>Go Comments</span></button></div> <div class=is-clearfix><button class="is-small button svelte-1uubpsp"><span class="is-small icon svelte-1uubpsp"><i class="svelte-1uubpsp fas fa-share-alt"></i></span> <span class=svelte-1uubpsp>Share to clipboard</span></button></div></div></div></div></div> <section class="reading-width section"><h1 class="title is-1">How to create a JSON table of contents with markdown-it and markdown-it-anchor</h1> <div class="is-medium blog content"> <p>There are some plugins to create a table of content using markdown-it, but sometimes you want to create a custom component for rendering your TOC.</p> <p>Here a simple example on how to get the table of content's tree with vanilla javascript without writing any markdown-it plugin.</p> <pre class="terminal gnome-terminal-image-container"><div class=bar><div class=btn></div><div class=bar-title>bash</div></div><div class=body><div class=image><img alt=o src=https://raw.githubusercontent.com/angelblanco/demo-markdown-it-anchor-toc-jsdom/master/demo.gif></div></div></pre> </div> <div class="svelte-1kd5tix box toc"><div class=menu><p class="menu-label has-text-info">On this article</p> <ul class=menu-list><li><a href=/articles/how-to-create-a-json-toc-with-markdown-it-anchor-using-jsdom/#basic-markdown-it-setup class=svelte-1kd5tix><span class="is-small icon anchor has-text-info svelte-1kd5tix"><i class="fas fa-hashtag"></i></span> Basic markdown it setup</a> <li><a href=/articles/how-to-create-a-json-toc-with-markdown-it-anchor-using-jsdom/#plain-table-of-content class=svelte-1kd5tix><span class="is-small icon anchor has-text-info svelte-1kd5tix"><i class="fas fa-hashtag"></i></span> Plain table of content</a> <li><a href=/articles/how-to-create-a-json-toc-with-markdown-it-anchor-using-jsdom/#tree-table-of-content class=svelte-1kd5tix><span class="is-small icon anchor has-text-info svelte-1kd5tix"><i class="fas fa-hashtag"></i></span> Tree table of content</a> <li><a href=/articles/how-to-create-a-json-toc-with-markdown-it-anchor-using-jsdom/#create-the-tables-of-content-on-the-server-side-with-jsdom class=svelte-1kd5tix><span class="is-small icon anchor has-text-info svelte-1kd5tix"><i class="fas fa-hashtag"></i></span> Create the tables of content on the server-side with jsdom</a> <li><a href=/articles/how-to-create-a-json-toc-with-markdown-it-anchor-using-jsdom/#conclusion class=svelte-1kd5tix><span class="is-small icon anchor has-text-info svelte-1kd5tix"><i class="fas fa-hashtag"></i></span> Conclusion</a> </ul></div></div> <div class="is-medium blog content articleBody"> <h2 id=basic-markdown-it-setup>Basic markdown it setup</h2> <blockquote> <p>If you want to skip this process and run the demo on your personal computer you can clone the demo repository on Github</p> <div class=github-link-container><a href=https://github.com/angelblanco/demo-markdown-it-anchor-toc-jsdom class="is-medium button" target=__blank><span class=icon><i class="fab fa-github"></i></span><span>Clone the demo of this article on Github</span></a></div></blockquote> <p>On your javascript application, we want to install some dependencies first.</p> <pre class=terminal>
  <div class="bar bar-language-bash">
    <div class=btn></div>
    <div class=bar-title>bash</div>
    <div><button class="is-small button copy is-pulled-right">Copy</button></div>  
  </div>
  <div class=body><pre class=language-bash><code><span class="hl--token hl--function">yarn</span> <span class="hl--token hl--function">add</span> --dev markdown-it markdown-it-anchor
</code></pre></div>
  </pre> <p>Now let's convert some simple markdown to Html:</p> <pre class=terminal>
  <div class="bar bar-language-javascript">
    <div class=btn></div>
    <div class=bar-title>javascript</div>
    <div><button class="is-small button copy is-pulled-right">Copy</button></div>  
  </div>
  <div class=body><pre class=language-javascript><code><span class="hl--token hl--comment">// demo.js</span>
<span class="hl--token hl--keyword">const</span> <span class="hl--token hl--maybe-class-name">MarkdownIt</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--function">require</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">'markdown-it'</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

<span class="hl--token hl--keyword">const</span> md <span class="hl--token hl--operator">=</span> <span class="hl--token hl--keyword">new</span> <span class="hl--token hl--class-name">MarkdownIt</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span>
    <span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">use</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--function">require</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">"markdown-it-anchor"</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

<span class="hl--token hl--keyword">const</span> markdownText <span class="hl--token hl--operator">=</span> <span class="hl--token hl--template-string"><span class="hl--token hl--string hl--template-punctuation">`</span><span class="hl--token hl--string">
# First header
Some content

## Second-level header
More content
### Third level header
## Another second-level header
</span><span class="hl--token hl--string hl--template-punctuation">`</span></span><span class="hl--token hl--punctuation">;</span>

<span class="hl--token hl--keyword">const</span> html <span class="hl--token hl--operator">=</span> md<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">render</span><span class="hl--token hl--punctuation">(</span>markdownText<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

<span class="hl--token hl--class-name hl--console">console</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">log</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">{</span> html <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
</code></pre></div>
  </pre> <h2 id=plain-table-of-content>Plain table of content</h2> <p>The first approach will be to create a plain TOC, that returns a one level array with the title, the anchor, and the associated level. Using this type of TOC could give you a really clear component, avoiding the extra complexity of recursion.</p> <pre class=terminal>
  <div class="bar bar-language-javascript">
    <div class=btn></div>
    <div class=bar-title>javascript</div>
    <div><button class="is-small button copy is-pulled-right">Copy</button></div>  
  </div>
  <div class=body><pre class=language-javascript><code><span class="hl--token hl--keyword">function</span> <span class="hl--token hl--function">createPlainToc</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--parameter">domElement</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
    <span class="hl--token hl--keyword">const</span> headers <span class="hl--token hl--operator">=</span> <span class="hl--token hl--class-name hl--known-class-name">Array</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--keyword hl--module">from</span><span class="hl--token hl--punctuation">(</span>domElement<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">querySelectorAll</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">'h1, h2, h3, h4, h5, h6, h7'</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

    <span class="hl--token hl--comment">// This will create a plain array with the level, the anchor and the header title</span>
    <span class="hl--token hl--keyword hl--control-flow">return</span> headers<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">map</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--parameter">header</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--operator hl--arrow">=></span> <span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">{</span>
        level<span class="hl--token hl--operator">:</span> <span class="hl--token hl--function">parseInt</span><span class="hl--token hl--punctuation">(</span>header<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">tagName</span><span class="hl--token hl--punctuation">[</span><span class="hl--token hl--number">1</span><span class="hl--token hl--punctuation">]</span><span class="hl--token hl--punctuation">,</span> <span class="hl--token hl--number">10</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">,</span>
        title<span class="hl--token hl--operator">:</span> header<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">textContent</span><span class="hl--token hl--punctuation">,</span>
        anchor<span class="hl--token hl--operator">:</span> <span class="hl--token hl--string">'#'</span> <span class="hl--token hl--operator">+</span> header<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">getAttribute</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">'id'</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">,</span>
    <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
<span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">;</span>
</code></pre></div>
  </pre> <p>Using the above markdown text, it will return us the following output:</p> <pre class=terminal>
  <div class="bar bar-language-javascript">
    <div class=btn></div>
    <div class=bar-title>javascript</div>
    <div><button class="is-small button copy is-pulled-right">Copy</button></div>  
  </div>
  <div class=body><pre class=language-javascript><code><span class="hl--token hl--punctuation">[</span>
  <span class="hl--token hl--punctuation">{</span> level<span class="hl--token hl--operator">:</span> <span class="hl--token hl--number">1</span><span class="hl--token hl--punctuation">,</span> title<span class="hl--token hl--operator">:</span> <span class="hl--token hl--string">'First header'</span><span class="hl--token hl--punctuation">,</span> anchor<span class="hl--token hl--operator">:</span> <span class="hl--token hl--string">'#first-header'</span> <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">,</span>
  <span class="hl--token hl--punctuation">{</span> level<span class="hl--token hl--operator">:</span> <span class="hl--token hl--number">2</span><span class="hl--token hl--punctuation">,</span> title<span class="hl--token hl--operator">:</span> <span class="hl--token hl--string">'Second level header'</span><span class="hl--token hl--punctuation">,</span>anchor<span class="hl--token hl--operator">:</span> <span class="hl--token hl--string">'#second-level-header'</span> <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">,</span>
  <span class="hl--token hl--punctuation">{</span> level<span class="hl--token hl--operator">:</span> <span class="hl--token hl--number">3</span><span class="hl--token hl--punctuation">,</span> title<span class="hl--token hl--operator">:</span> <span class="hl--token hl--string">'Third level header'</span><span class="hl--token hl--punctuation">,</span> anchor<span class="hl--token hl--operator">:</span> <span class="hl--token hl--string">'#third-level-header'</span> <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">,</span>
  <span class="hl--token hl--punctuation">{</span> level<span class="hl--token hl--operator">:</span> <span class="hl--token hl--number">2</span><span class="hl--token hl--punctuation">,</span> title<span class="hl--token hl--operator">:</span> <span class="hl--token hl--string">'Another second level header'</span><span class="hl--token hl--punctuation">,</span> anchor<span class="hl--token hl--operator">:</span> <span class="hl--token hl--string">'#another-second-level-header'</span> <span class="hl--token hl--punctuation">}</span>
<span class="hl--token hl--punctuation">]</span>
</code></pre></div>
  </pre> <blockquote> <p>Alternatively you can test the above function with this page itself. You can copy the function and run the following code on the browser's console</p> <pre class=terminal>
  <div class="bar bar-language-javascript">
    <div class=btn></div>
    <div class=bar-title>javascript</div>
    <div><button class="is-small button copy is-pulled-right">Copy</button></div>  
  </div>
  <div class=body><pre class=language-javascript><code><span class="hl--token hl--class-name hl--console">console</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">log</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--class-name hl--known-class-name">JSON</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">stringify</span><span class="hl--token hl--punctuation">(</span>
  <span class="hl--token hl--function">createPlainToc</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">querySelector</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">'.articleBody'</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">)</span>
<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
</code></pre></div>
  </pre> </blockquote> <h2 id=tree-table-of-content>Tree table of content</h2> <p>Most of the time we will be interested in creating a tree representation of the data. In this way, we can create a recursive component that runs through the tree. We can reuse our previous function and build the data using a stack and tacking advantage of object references in Javascript. We must perform two validations:</p> <ol> <li>We force all root nodes to have the same level, but not a minimum one.</li> <li>We force all children nodes to have the parent's level + 1.</li> </ol> <pre class=terminal>
  <div class="bar bar-language-javascript">
    <div class=btn></div>
    <div class=bar-title>javascript</div>
    <div><button class="is-small button copy is-pulled-right">Copy</button></div>  
  </div>
  <div class=body><pre class=language-javascript><code><span class="hl--token hl--keyword">function</span> <span class="hl--token hl--function">createTreeToc</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--parameter">domElement<span class="hl--token hl--punctuation">,</span> throwOnNotTree <span class="hl--token hl--operator">=</span> <span class="hl--token hl--boolean">true</span></span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
    <span class="hl--token hl--keyword">const</span> treeItems <span class="hl--token hl--operator">=</span> <span class="hl--token hl--function">createPlainToc</span><span class="hl--token hl--punctuation">(</span>domElement<span class="hl--token hl--punctuation">)</span>
        <span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">map</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--parameter">item</span> <span class="hl--token hl--operator hl--arrow">=></span> <span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">{</span> <span class="hl--token hl--operator hl--spread">...</span>item<span class="hl--token hl--punctuation">,</span> children<span class="hl--token hl--operator">:</span> <span class="hl--token hl--punctuation">[</span><span class="hl--token hl--punctuation">]</span> <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

    <span class="hl--token hl--keyword">const</span> tree <span class="hl--token hl--operator">=</span> <span class="hl--token hl--punctuation">[</span><span class="hl--token hl--punctuation">]</span><span class="hl--token hl--punctuation">;</span>
    <span class="hl--token hl--keyword">const</span> stack <span class="hl--token hl--operator">=</span> <span class="hl--token hl--punctuation">[</span><span class="hl--token hl--punctuation">]</span><span class="hl--token hl--punctuation">;</span>
    treeItems<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">forEach</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--parameter">item</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--operator hl--arrow">=></span> <span class="hl--token hl--punctuation">{</span>
        <span class="hl--token hl--keyword">let</span> parentItem <span class="hl--token hl--operator">=</span> <span class="hl--token hl--keyword hl--nil hl--null">null</span><span class="hl--token hl--punctuation">;</span>
        <span class="hl--token hl--keyword hl--control-flow">do</span> <span class="hl--token hl--punctuation">{</span>
            parentItem <span class="hl--token hl--operator">=</span> stack<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">pop</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
        <span class="hl--token hl--punctuation">}</span> <span class="hl--token hl--keyword hl--control-flow">while</span> <span class="hl--token hl--punctuation">(</span>parentItem <span class="hl--token hl--operator">&&</span> parentItem<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">level</span> <span class="hl--token hl--operator">>=</span> item<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">level</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

        <span class="hl--token hl--keyword hl--control-flow">if</span> <span class="hl--token hl--punctuation">(</span><span class="hl--token hl--operator">!</span>parentItem<span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
            <span class="hl--token hl--comment">// All nodes in tree[] must have the same level. </span>
            <span class="hl--token hl--keyword">const</span> prevTreeItem <span class="hl--token hl--operator">=</span> tree<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">pop</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
            <span class="hl--token hl--keyword hl--control-flow">if</span> <span class="hl--token hl--punctuation">(</span>prevTreeItem<span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
                <span class="hl--token hl--keyword hl--control-flow">if</span> <span class="hl--token hl--punctuation">(</span>throwOnNotTree <span class="hl--token hl--operator">&&</span> item<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">level</span> <span class="hl--token hl--operator">!==</span> prevTreeItem<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">level</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
                    <span class="hl--token hl--keyword hl--control-flow">throw</span> <span class="hl--token hl--keyword">new</span> <span class="hl--token hl--class-name">Error</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--template-string"><span class="hl--token hl--string hl--template-punctuation">`</span><span class="hl--token hl--string">Root titles dont have same level on: "</span><span class="hl--token hl--interpolation"><span class="hl--token hl--punctuation hl--interpolation-punctuation">${</span>item<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">title</span><span class="hl--token hl--punctuation hl--interpolation-punctuation">}</span></span><span class="hl--token hl--string">"</span><span class="hl--token hl--string hl--template-punctuation">`</span></span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
                <span class="hl--token hl--punctuation">}</span>

                tree<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">push</span><span class="hl--token hl--punctuation">(</span>prevTreeItem<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
            <span class="hl--token hl--punctuation">}</span>

            tree<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">push</span><span class="hl--token hl--punctuation">(</span>item<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
            stack<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">push</span><span class="hl--token hl--punctuation">(</span>item<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
        <span class="hl--token hl--punctuation">}</span> <span class="hl--token hl--keyword hl--control-flow">else</span> <span class="hl--token hl--punctuation">{</span>
            <span class="hl--token hl--keyword hl--control-flow">if</span> <span class="hl--token hl--punctuation">(</span>throwOnNotTree <span class="hl--token hl--operator">&&</span> parentItem<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">level</span> <span class="hl--token hl--operator">!==</span> <span class="hl--token hl--punctuation">(</span>item<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">level</span> <span class="hl--token hl--operator">-</span> <span class="hl--token hl--number">1</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
                <span class="hl--token hl--comment">// All nodes in tree[] must have the same level. </span>
                <span class="hl--token hl--keyword hl--control-flow">throw</span> <span class="hl--token hl--keyword">new</span> <span class="hl--token hl--class-name">Error</span><span class="hl--token hl--punctuation">(</span>
                    <span class="hl--token hl--template-string"><span class="hl--token hl--string hl--template-punctuation">`</span><span class="hl--token hl--string">The title "</span><span class="hl--token hl--interpolation"><span class="hl--token hl--punctuation hl--interpolation-punctuation">${</span>item<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">title</span><span class="hl--token hl--punctuation hl--interpolation-punctuation">}</span></span><span class="hl--token hl--string">" is not a direct children of its parent</span><span class="hl--token hl--string hl--template-punctuation">`</span></span>
                <span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
            <span class="hl--token hl--punctuation">}</span>

            stack<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">push</span><span class="hl--token hl--punctuation">(</span>parentItem<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
            stack<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">push</span><span class="hl--token hl--punctuation">(</span>item<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
            parentItem<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">children</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">push</span><span class="hl--token hl--punctuation">(</span>item<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
        <span class="hl--token hl--punctuation">}</span>
    <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

    <span class="hl--token hl--keyword hl--control-flow">return</span> tree<span class="hl--token hl--punctuation">;</span>
<span class="hl--token hl--punctuation">}</span>
</code></pre></div>
  </pre> <p>Using the previous markdown we will have a well-defined tree for each top-level header and their associated children.</p> <pre class=terminal>
  <div class="bar bar-language-javascript">
    <div class=btn></div>
    <div class=bar-title>javascript</div>
    <div><button class="is-small button copy is-pulled-right">Copy</button></div>  
  </div>
  <div class=body><pre class=language-javascript><code><span class="hl--token hl--punctuation">[</span>
  <span class="hl--token hl--punctuation">{</span>
    level<span class="hl--token hl--operator">:</span> <span class="hl--token hl--number">1</span><span class="hl--token hl--punctuation">,</span>
    title<span class="hl--token hl--operator">:</span> <span class="hl--token hl--string">'First header'</span><span class="hl--token hl--punctuation">,</span>
    anchor<span class="hl--token hl--operator">:</span> <span class="hl--token hl--string">'#first-header'</span><span class="hl--token hl--punctuation">,</span>
    children<span class="hl--token hl--operator">:</span> <span class="hl--token hl--punctuation">[</span>
      <span class="hl--token hl--punctuation">{</span>
        level<span class="hl--token hl--operator">:</span> <span class="hl--token hl--number">2</span><span class="hl--token hl--punctuation">,</span>
        title<span class="hl--token hl--operator">:</span> <span class="hl--token hl--string">'Second level header'</span><span class="hl--token hl--punctuation">,</span>
        anchor<span class="hl--token hl--operator">:</span> <span class="hl--token hl--string">'#second-level-header'</span><span class="hl--token hl--punctuation">,</span>
        children<span class="hl--token hl--operator">:</span> <span class="hl--token hl--punctuation">[</span>
          <span class="hl--token hl--punctuation">{</span> level<span class="hl--token hl--operator">:</span> <span class="hl--token hl--number">3</span><span class="hl--token hl--punctuation">,</span> title<span class="hl--token hl--operator">:</span> <span class="hl--token hl--string">'Third level header'</span><span class="hl--token hl--punctuation">,</span> anchor<span class="hl--token hl--operator">:</span> <span class="hl--token hl--string">'#third-level-header'</span><span class="hl--token hl--punctuation">,</span> children<span class="hl--token hl--operator">:</span> <span class="hl--token hl--punctuation">[</span><span class="hl--token hl--punctuation">]</span><span class="hl--token hl--punctuation">}</span>
        <span class="hl--token hl--punctuation">]</span>
      <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">,</span>
      <span class="hl--token hl--punctuation">{</span>
        level<span class="hl--token hl--operator">:</span> <span class="hl--token hl--number">2</span><span class="hl--token hl--punctuation">,</span>
        title<span class="hl--token hl--operator">:</span> <span class="hl--token hl--string">'Another second level header'</span><span class="hl--token hl--punctuation">,</span>
        anchor<span class="hl--token hl--operator">:</span> <span class="hl--token hl--string">'#another-second-level-header'</span><span class="hl--token hl--punctuation">,</span>
        children<span class="hl--token hl--operator">:</span> <span class="hl--token hl--punctuation">[</span><span class="hl--token hl--punctuation">]</span>
      <span class="hl--token hl--punctuation">}</span>
    <span class="hl--token hl--punctuation">]</span>
  <span class="hl--token hl--punctuation">}</span>
<span class="hl--token hl--punctuation">]</span>
</code></pre></div>
  </pre> <p>Of course opening the dev tools you can paste the previous functions, an test it with this page!</p> <pre class=terminal>
  <div class="bar bar-language-javascript">
    <div class=btn></div>
    <div class=bar-title>javascript</div>
    <div><button class="is-small button copy is-pulled-right">Copy</button></div>  
  </div>
  <div class=body><pre class=language-javascript><code><span class="hl--token hl--class-name hl--console">console</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">log</span><span class="hl--token hl--punctuation">(</span>
  <span class="hl--token hl--class-name hl--known-class-name">JSON</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">stringify</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--function">createTreeToc</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">querySelector</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">'.articleBody'</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">)</span>
<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span> 
</code></pre></div>
  </pre> <h2 id=create-the-tables-of-content-on-the-server-side-with-jsdom>Create the tables of content on the server-side with jsdom</h2> <p>If you want to create the TOC on your node server or at the moment of compiling your markdown files, we can reuse our functions by installing <a href=https://github.com/jsdom/jsdom target=_blank>jsdom</a>.</p> <pre class=terminal>
  <div class="bar bar-language-bash">
    <div class=btn></div>
    <div class=bar-title>bash</div>
    <div><button class="is-small button copy is-pulled-right">Copy</button></div>  
  </div>
  <div class=body><pre class=language-bash><code><span class="hl--token hl--function">yarn</span> <span class="hl--token hl--function">add</span> --dev jsdom
</code></pre></div>
  </pre> <p>As the Html will be the hole markdown file we can create the table of content for the whole <code>window.document</code>.</p> <pre class=terminal>
  <div class="bar bar-language-javascript">
    <div class=btn></div>
    <div class=bar-title>javascript</div>
    <div><button class="is-small button copy is-pulled-right">Copy</button></div>  
  </div>
  <div class=body><pre class=language-javascript><code><span class="hl--token hl--comment">// Asuming that html is the rendered markdown with html and nothing else.</span>
<span class="hl--token hl--keyword">const</span> domElement <span class="hl--token hl--operator">=</span> <span class="hl--token hl--punctuation">(</span><span class="hl--token hl--keyword">new</span> <span class="hl--token hl--class-name">jsdom<span class="hl--token hl--punctuation">.</span>JSDOM</span><span class="hl--token hl--punctuation">(</span>html<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">document</span><span class="hl--token hl--punctuation">;</span>

<span class="hl--token hl--keyword">const</span> toc <span class="hl--token hl--operator">=</span> <span class="hl--token hl--function">createTreeToc</span><span class="hl--token hl--punctuation">(</span>domElement<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

<span class="hl--token hl--class-name hl--console">console</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">log</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--class-name hl--known-class-name">JSON</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">stringify</span><span class="hl--token hl--punctuation">(</span>toc<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span> 
</code></pre></div>
  </pre> <p>Using this last approach its how I set up a simple demo on Github.</p> <div class=github-link-container><a href=https://github.com/angelblanco/demo-markdown-it-anchor-toc-jsdom class="is-medium button" target=__blank><span class=icon><i class="fab fa-github"></i></span><span>Clone the demo of this article on Github</span></a></div><h2 id=conclusion>Conclusion</h2> <p>Using <code>jsdom</code> to parse the whole HTML file to get the table of content might look like an overhead. However, doing this stuff at your javascript compile stage will get you the fastest loading times for your web because it could be server-side rendered. On the other hand, if you parse your TOC in the browser you could access all the DOM elements on the web and not only the markdown ones.</p> <p>Thank you very much for your time. Hope to see you again 🚀</p> </div> <div class=is-hidden-print><hr> <div><div class=has-text-centered><div><span class="has-text-centered has-text-grey-dark has-text-weight-bold">Share </span></div> <div><a href="https://twitter.com/intent/tweet?url=https://angelblanco.dev/articles/how-to-create-a-json-toc-with-markdown-it-anchor-using-jsdom/&text=How%20to%20create%20a%20JSON%20table%20of%20contents%20with%20markdown-it%20and%20markdown-it-anchor&via=angelblancodev" class="icon is-medium" target=__blank><i class="fab fa-lg fa-twitter"></i> </a><a href="https://wwww.facebook.com/sharer.php?u=https://angelblanco.dev/articles/how-to-create-a-json-toc-with-markdown-it-anchor-using-jsdom/&t=How%20to%20create%20a%20JSON%20table%20of%20contents%20with%20markdown-it%20and%20markdown-it-anchor" class="icon is-medium" target=__blank><i class="fab fa-lg fa-facebook"></i> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https://angelblanco.dev/articles/how-to-create-a-json-toc-with-markdown-it-anchor-using-jsdom/" class="icon is-medium" target=__blank><i class="fab fa-lg fa-linkedin-in"></i> </a></div></div></div> <div class="svelte-r30y44 columns is-centered mt-3 tiny-letter"><div class="svelte-r30y44 column"><div class="box pb-5 tiny-letter"><div class=content><h4>Subscribe to the newsletter 🚀</h4> <p>Keep up to date with the latest web development posts, at most once a week. </p> </div> <form action=https://tinyletter.com/angelblanco class=fields method=post target=popupwindow><div class="has-addons field"><div class="control is-expanded"><input name=email type=email value="" class=input id=tlemail placeholder="Your email address"></div> <div class=control><button class="is-info button">Subscribe </button></div></div> <input name=embed type=hidden value=1></form> <div class="is-clearfix is-size-7"><a href=https://tinyletter.com class="is-pulled-right has-text-grey-light" target=_blank>powered by TinyLetter </a></div></div></div></div></div></section> <section class="is-hidden-print reading-width section" id=comments><h3 class="title is-3">Comments</h3> <div id=disqus_thread></div></section> <div class="afterArticleContainer svelte-1xs3w5z"></div> </div></main> <footer class="svelte-1yghtac footer info"><hr class="svelte-1yghtac is-hidden-print footerRule"> <div class=has-text-centered><p class="svelte-1yghtac has-text-grey-light is-family-monospace">Personal website of <a href=/about/ class="svelte-1yghtac has-text-grey-dark">Ángel Blanco</a></p> <p class="svelte-1yghtac is-hidden-print footer-github"><a href=https://github.com/angelblanco/angelblanco.dev class="is-small button svelte-1yghtac" target=__blank><span class=icon><span class="fab fa-github"></span></span> <span>Developed by Ángel Blanco hosted on Github</span></a></p> <div class="svelte-1yghtac is-hidden-print is-m-auto libraries-box"><div class=box><p class="svelte-1yghtac has-text-grey-light is-family-monospace">This project <i class="svelte-1yghtac fa-heart fas"></i> this libraries </p> <div class="field is-grouped is-grouped-multiline is-m-auto justify-center"><div class=control><div class="has-addons tags"><span class="tag is-dark">framework</span> <a href=https://sapper.svelte.dev/ class="svelte-1yghtac is-light tag">sapper</a></div> </div><div class=control><div class="has-addons tags"><span class="tag is-dark">css</span> <a href=https://bulma.io/ class="svelte-1yghtac is-light tag">bulma</a></div> </div><div class=control><div class="has-addons tags"><span class="tag is-dark">js</span> <a href=https://svelte.dev/ class="svelte-1yghtac is-light tag">svelte</a></div> </div><div class=control><div class="has-addons tags"><span class="tag is-dark">bundler</span> <a href=https://rollupjs.org/ class="svelte-1yghtac is-light tag">rollup</a></div> </div><div class=control><div class="has-addons tags"><span class="tag is-dark">md</span> <a href=https://github.com/markdown-it/markdown-it class="svelte-1yghtac is-light tag">markdown-it</a></div> </div></div> <p class="svelte-1yghtac has-text-grey-light is-family-monospace is-size-7">And all of <a href=/libraries/ class="svelte-1yghtac has-text-grey-dark has-decoration-underline" rel=preload>these...</a></div></div></div></footer></div> 