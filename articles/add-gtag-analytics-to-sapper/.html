<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <meta name="theme-color" content="#333333" />
    <link rel="manifest" href="/manifest.json" crossorigin="use-credentials" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <meta http-equiv="content-security-policy" content=""><title>Add Google Analytics&#39; gtag to a Sapper project - Angel Blanco&#39;s blog</title><meta name="description" content="Step by step guide to create a component that tracks your sapper application every time the user changes its URL with virtual page views." data-svelte="svelte-aky1d0"><meta property="og:url" content="https://angelblanco.dev/articles/add-gtag-analytics-to-sapper/" data-svelte="svelte-aky1d0"><meta property="og:title" content="Add Google Analytics&#39; gtag to a Sapper project" data-svelte="svelte-aky1d0"><meta property="og:description" content="Step by step guide to create a component that tracks your sapper application every time the user changes its URL with virtual page views." data-svelte="svelte-aky1d0"><meta property="og:image" content="https://angelblanco.dev/images/share-default.png" data-svelte="svelte-aky1d0"><meta property="og:image:width" content="1200" data-svelte="svelte-aky1d0"><meta property="og:image:height" content="630" data-svelte="svelte-aky1d0"><meta property="og:locale" content="en_US" data-svelte="svelte-aky1d0"><meta property="og:author" content="Ángel Blanco" data-svelte="svelte-aky1d0"><meta name="twitter:title" content="Add Google Analytics&#39; gtag to a Sapper project" data-svelte="svelte-aky1d0"><meta name="twitter:description" content="Step by step guide to create a component that tracks your sapper application every time the user changes its URL with virtual page views." data-svelte="svelte-aky1d0"><meta name="twitter:card" content="summary_large_image" data-svelte="svelte-aky1d0"><meta name="twitter:site" content="@angelblancodev" data-svelte="svelte-aky1d0"><meta name="twitter:creator" content="@angelblancodev" data-svelte="svelte-aky1d0"><meta name="twitter:image" content="https://angelblanco.dev/images/share-default.png" data-svelte="svelte-aky1d0">
	<link rel="stylesheet" href="/_app/assets/pages/__layout.svelte-5c496c17.css">
	<link rel="stylesheet" href="/_app/assets/pages/articles/_slug_.svelte-39d0f134.css">
	<link rel="stylesheet" href="/_app/assets/TinyLetterSubscribeForm.svelte_svelte_type_style_lang-9e0ab98b.css">
	<link rel="modulepreload" href="/_app/start-f8140ddd.js">
	<link rel="modulepreload" href="/_app/chunks/vendor-54c6ab91.js">
	<link rel="modulepreload" href="/_app/pages/__layout.svelte-97c00a7f.js">
	<link rel="modulepreload" href="/_app/chunks/utils-123120c2.js">
	<link rel="modulepreload" href="/_app/chunks/canonical-fdacf4d6.js">
	<link rel="modulepreload" href="/_app/pages/articles/__layout.svelte-e94d3e2a.js">
	<link rel="modulepreload" href="/_app/pages/articles/_slug_.svelte-5a52e418.js">
	<link rel="modulepreload" href="/_app/chunks/Content-2ed3ba46.js">
	<link rel="modulepreload" href="/_app/chunks/Head-46f166e7.js">
	<link rel="modulepreload" href="/_app/chunks/meta-ebf74df4.js">
	<link rel="modulepreload" href="/_app/chunks/Tags-89f21549.js">
				<script>
		if ('serviceWorker' in navigator) {
			navigator.serviceWorker.register('/service-worker.js');
		}
	</script>
  </head>
  <body>
    



<nav class="navbar container is-hidden-print" aria-label="main navigation"><div class="navbar-brand"><a class="navbar-item svelte-19lyduh" href="/">
      <img alt="logo" src="/logo.png" width="160" height="24"></a>

    <span role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample"><span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span></span></div>

  <div class="navbar-menu svelte-19lyduh"><div class="navbar-end"><a rel="prefetch" class="navbar-item is-primary is-active svelte-19lyduh" href="/articles/"><span class="icon is-hidden-desktop"><i class="fas fa-book fa-lg"></i></span>
        <span>Articles</span></a>
      <a rel="prefecth" class="navbar-item is-primary  svelte-19lyduh" href="/about/"><span class="icon is-hidden-desktop"><i class="fas fa-user fa-lg"></i></span>
        <span>About</span></a>

      <a href="https://github.com/angelblanco/angelblanco.dev" target="__blank" class="navbar-item svelte-19lyduh" aria-label="My Github page"><span class="icon"><i class="fab fa-github-alt fa-lg"></i></span>

        <span class="is-hidden-desktop">Github</span></a></div></div>
</nav>


<div class="back-to-top is-hidden-print svelte-1d29tie hidden"><span class="icon is-large"><i class="fas fa-chevron-up fa-2x svelte-1d29tie"></i></span>
</div>

<main class="blog"><div class="container">



<section class="section reading-width pb-0"><article class="media"><figure class="media-left"><a href="/about/" rel="prefecth" class="image is-64x64" aria-label="Abot the author"><img class="is-rounded" src="/images/me-128x128.jpeg" alt="user" width="128" height="128"></a></figure>

  <div class="media-content"><div class="media-title-container svelte-1d83kht"><span>Ángel Blanco </span>

      <span class="date-subtitle has-text-grey-light" aria-label="Written at 2020-10-28. Estimated 5 min read">2020-10-28 · 5 min read</span></div>

    <div class="tags " aria-hidden="true"><a rel="prefetch" href="/tag/svelte/" class="tag is-light is-medium svelte" aria-hidden="true">Svelte</a><a rel="prefetch" href="/tag/js/" class="tag is-light is-medium js" aria-hidden="true">Javascript</a><a rel="prefetch" href="/tag/blog/" class="tag is-light is-medium blog" aria-hidden="true">Blog</a></div></div>

  <div class="media-right"></div>
</article></section>



<div class="nprogress svelte-1cv4mhg hidden" style="transition: opacity 300ms linear"><div class="bar svelte-1cv4mhg" style="margin-left: -100%;transition: all 300ms linear"></div>
</div>


<div class="article-sidebar-overlay svelte-1uubpsp hidden"><div class="section reading-width svelte-1uubpsp"><div class="sidebar svelte-1uubpsp"><div class="social-icons has-text-align-left svelte-1uubpsp"><div class="is-clearfix"><a href="https://twitter.com/intent/tweet?url=https://angelblanco.dev/articles/add-gtag-analytics-to-sapper/&amp;text=Add%20Google%20Analytics&#39;%20gtag%20to%20a%20Sapper%20project&amp;via=angelblancodev" target="__blank" class="button is-small svelte-1uubpsp"><span class="icon is-small svelte-1uubpsp"><i class="fab fa-twitter svelte-1uubpsp"></i></span>
              <span>Share on Twitter</span></a>
          </div><div class="is-clearfix"><a href="https://wwww.facebook.com/sharer.php?u=https://angelblanco.dev/articles/add-gtag-analytics-to-sapper/&amp;t=Add%20Google%20Analytics&#39;%20gtag%20to%20a%20Sapper%20project" target="__blank" class="button is-small svelte-1uubpsp"><span class="icon is-small svelte-1uubpsp"><i class="fab fa-facebook svelte-1uubpsp"></i></span>
              <span>Share on Facebook</span></a>
          </div><div class="is-clearfix"><a href="https://www.linkedin.com/sharing/share-offsite/?url=https://angelblanco.dev/articles/add-gtag-analytics-to-sapper/" target="__blank" class="button is-small svelte-1uubpsp"><span class="icon is-small svelte-1uubpsp"><i class="fab fa-linkedin-in svelte-1uubpsp"></i></span>
              <span>Share on Linkedin</span></a>
          </div>

        <div class="is-clearfix"><button class="button is-small svelte-1uubpsp"><span class="icon is-small svelte-1uubpsp"><i class="fas fa-comments svelte-1uubpsp"></i></span>
            <span>Go Comments</span></button></div>

        <div class="is-clearfix"><button class="button is-small  svelte-1uubpsp"><span class="icon is-small svelte-1uubpsp"><i class="fas fa-share-alt svelte-1uubpsp"></i></span>
            <span class="svelte-1uubpsp">Share to clipboard</span></button></div></div></div></div>
</div>

<section class="section reading-width"><h1 class="title is-1">Add Google Analytics&#39; gtag to a Sapper project</h1>

  <div class="content is-medium blog ">
    <!-- HTML_TAG_START --><p>Adding Google Analytics support to a single page application that changes the URL on the client-side could be tricky. It's not as simple as adding tracking to a server-side rendered application that refreshes its scripts on every page hit.</p>
<p>To get the real flow of a user across your Sapper website, you need to track all the URL changes that happen when the user follows a Svelte link. Let's simplify the tracking of the pageview event on Sapper with a component without using any third party library!</p>
<!-- HTML_TAG_END -->
  </div>

  <div class="box toc svelte-nxtey2"><div class="menu"><p class="menu-label has-text-info svelte-nxtey2">On this article</p>
      <ul class="menu-list"><li><a href="#in-depth-tutorial" class="svelte-nxtey2">In-depth tutorial</a>

            <ul><li><a href="#before-start-steps" class="svelte-nxtey2">Before start steps</a>
                  </li><li><a href="#insert-the-google-script-on-the-page-with-vanilla-js" class="svelte-nxtey2">Insert the google script on the page with vanilla JS</a>
                  </li><li><a href="#track-the-first-hit-of-your-web-page" class="svelte-nxtey2">Track the first hit of your web page</a>
                  </li><li><a href="#detecting-page-changes-on-your-sapper-single-page-application" class="svelte-nxtey2">Detecting page changes on your Sapper single page application</a>
                  </li>
              </ul>
          </li><li><a href="#google-analytics-svelte-component" class="svelte-nxtey2">Google Analytics svelte component</a>

            
          </li></ul></div></div>

  <div class="content is-medium blog articleBody">
    <!-- HTML_TAG_START --><h2 id="in-depth-tutorial" tabindex="-1"><a class="header-anchor" href="#in-depth-tutorial">In-depth tutorial</a></h2>
<p>In this first part of the tutorial, I will try to explain how to approach the inclusion of any third party script with a custom component. Note that sometimes including it on your <code>template.html</code> will have you covered.</p>
<blockquote>
<p>If you have a tracking id and want to skip this reading, please go directly to
<a href="#google-analytics-svelte-component">Google Analytics Svelte component</a>.</p>
</blockquote>
<h3 id="before-start-steps" tabindex="-1"><a class="header-anchor" href="#before-start-steps">Before start steps</a></h3>
<p>First of all, you need to register your domain on <a href="https://analytics.google.com/" target="_blank">Google Analytics</a>. Following all the desired steps, you will have access to a tracking id. The number we should have will look like <code>UA-000000-2</code>. Don't worry, if you lose it you will have access to it on the Admin section of your property.</p>
<h3 id="insert-the-google-script-on-the-page-with-vanilla-js" tabindex="-1"><a class="header-anchor" href="#insert-the-google-script-on-the-page-with-vanilla-js">Insert the google script on the page with vanilla JS</a></h3>
<p>We cannot inject a script with <code>src</code> on our Svelte component template. Even if we could do so, it will not be as great as having all the control in your component. So what we are going to create a script element with Javascript, assigning it a unique identifier and mount it to the end of the document body.</p>
<p>As sapper ships with ES6 support out of the box and promises are supported, we will create one that resolves or rejects based on the script execution. This way, we can perform actions on error like removing the script on connection issues or when an adblocker is disabling <code>gtag</code>.</p>
<pre class="terminal">
  <div class="bar bar-language-javascript">
    <div class="btn"></div>
    <div class="bar-title">javascript</div>
    <div><button class="button copy is-small is-pulled-right">Copy</button></div>  
  </div>
  <div class="body"><pre class="language-javascript"><code><span class="hl--token hl--keyword hl--module">export</span> <span class="hl--token hl--keyword">let</span> domain <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">'https://www.googletagmanager.com'</span><span class="hl--token hl--punctuation">;</span>
<span class="hl--token hl--keyword hl--module">export</span> <span class="hl--token hl--keyword">let</span> scriptId <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">'google-analytics-script'</span><span class="hl--token hl--punctuation">;</span>
<span class="hl--token hl--keyword hl--module">export</span> <span class="hl--token hl--keyword">let</span> trackingId <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">'UA-000000-2'</span><span class="hl--token hl--punctuation">;</span>

<span class="hl--token hl--keyword">async</span> <span class="hl--token hl--keyword">function</span> <span class="hl--token hl--function">addGoogleAnalyticsScript</span><span class="hl--token hl--punctuation">(</span>dataLayerName <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">'dataLayer'</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
  <span class="hl--token hl--keyword hl--control-flow">return</span> <span class="hl--token hl--keyword">new</span> <span class="hl--token hl--class-name">Promise</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--parameter">resolve<span class="hl--token hl--punctuation">,</span> reject</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--arrow hl--operator">=></span> <span class="hl--token hl--punctuation">{</span>
    <span class="hl--token hl--keyword">const</span> head <span class="hl--token hl--operator">=</span> <span class="hl--token hl--dom hl--variable">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">head</span> <span class="hl--token hl--operator">||</span> <span class="hl--token hl--dom hl--variable">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">getElementsByTagName</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">'head'</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">[</span><span class="hl--token hl--number">0</span><span class="hl--token hl--punctuation">]</span><span class="hl--token hl--punctuation">;</span>

    <span class="hl--token hl--keyword">const</span> link <span class="hl--token hl--operator">=</span> <span class="hl--token hl--dom hl--variable">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">createElement</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">'link'</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
    link<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">href</span> <span class="hl--token hl--operator">=</span> domain<span class="hl--token hl--punctuation">;</span>
    link<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">rel</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">'preconnect'</span><span class="hl--token hl--punctuation">;</span>
    head<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">appendChild</span><span class="hl--token hl--punctuation">(</span>link<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

    <span class="hl--token hl--keyword">const</span> script <span class="hl--token hl--operator">=</span> <span class="hl--token hl--dom hl--variable">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">createElement</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">'script'</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
    script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">async</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--boolean">true</span><span class="hl--token hl--punctuation">;</span>
    script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">src</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--template-string"><span class="hl--token hl--template-punctuation hl--string">`</span><span class="hl--token hl--interpolation"><span class="hl--token hl--interpolation-punctuation hl--punctuation">${</span>domain<span class="hl--token hl--interpolation-punctuation hl--punctuation">}</span></span><span class="hl--token hl--string">/gtag/js?id=</span><span class="hl--token hl--interpolation"><span class="hl--token hl--interpolation-punctuation hl--punctuation">${</span>trackingId<span class="hl--token hl--interpolation-punctuation hl--punctuation">}</span></span><span class="hl--token hl--string">&amp;l=</span><span class="hl--token hl--interpolation"><span class="hl--token hl--interpolation-punctuation hl--punctuation">${</span>dataLayerName<span class="hl--token hl--interpolation-punctuation hl--punctuation">}</span></span><span class="hl--token hl--template-punctuation hl--string">`</span></span><span class="hl--token hl--punctuation">;</span>
    script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">charset</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">'utf-8'</span><span class="hl--token hl--punctuation">;</span>
    script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">setAttribute</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">'id'</span><span class="hl--token hl--punctuation">,</span> scriptId<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

    head<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">appendChild</span><span class="hl--token hl--punctuation">(</span>script<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

    script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">onload</span> <span class="hl--token hl--operator">=</span> resolve<span class="hl--token hl--punctuation">;</span>
    script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">onerror</span> <span class="hl--token hl--operator">=</span> reject<span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
<span class="hl--token hl--punctuation">}</span>
</code></pre></div>
  </pre>
<h3 id="track-the-first-hit-of-your-web-page" tabindex="-1"><a class="header-anchor" href="#track-the-first-hit-of-your-web-page">Track the first hit of your web page</a></h3>
<p>Google Analytics tracking will happen on the client-side. That means that we must prepare our component tracking to happen only when mounted.
Due to it, we will use a flag <code>mounted</code> that will tell if Google Analytics script has mounted successfully in a previous URL.</p>
<p>On failure, we will remove the script just in case you want to create some retrying mechanism. Note that by default, Sapper applications ship with a <a href="https://developer.mozilla.org/es/docs/Web/API/Service_Worker_API" target="_blank">Service Worker</a> that will have you covered in some cases when the client loses its internet connection. In this case, we are logging the error and removing the script.</p>
<pre class="terminal">
  <div class="bar bar-language-javascript">
    <div class="btn"></div>
    <div class="bar-title">javascript</div>
    <div><button class="button copy is-small is-pulled-right">Copy</button></div>  
  </div>
  <div class="body"><pre class="language-javascript"><code><span class="hl--token hl--keyword hl--module">import</span> <span class="hl--token hl--imports"><span class="hl--token hl--punctuation">{</span> onMount <span class="hl--token hl--punctuation">}</span></span> <span class="hl--token hl--keyword hl--module">from</span> <span class="hl--token hl--string">'svelte'</span><span class="hl--token hl--punctuation">;</span>
<span class="hl--token hl--keyword hl--module">export</span> <span class="hl--token hl--keyword">let</span> scriptId <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">'google-analytics-script'</span><span class="hl--token hl--punctuation">;</span>
<span class="hl--token hl--keyword hl--module">export</span> <span class="hl--token hl--keyword">let</span> trackingId <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">'UA-000000-2'</span><span class="hl--token hl--punctuation">;</span>

<span class="hl--token hl--keyword">let</span> mounted <span class="hl--token hl--operator">=</span> <span class="hl--token hl--boolean">false</span><span class="hl--token hl--punctuation">;</span>

<span class="hl--token hl--function">onMount</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--keyword">async</span> <span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--arrow hl--operator">=></span> <span class="hl--token hl--punctuation">{</span>
  <span class="hl--token hl--keyword hl--control-flow">if</span> <span class="hl--token hl--punctuation">(</span><span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">getElementById</span><span class="hl--token hl--punctuation">(</span>scriptId<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
    <span class="hl--token hl--keyword hl--control-flow">return</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--punctuation">}</span>

  <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">dataLayer</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">dataLayer</span> <span class="hl--token hl--operator">||</span> <span class="hl--token hl--punctuation">[</span><span class="hl--token hl--punctuation">]</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method-variable hl--function-variable hl--method hl--function hl--property-access">gtag</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--keyword">function</span> <span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
    <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">dataLayer</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">push</span><span class="hl--token hl--punctuation">(</span>arguments<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--function">gtag</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">'js'</span><span class="hl--token hl--punctuation">,</span> <span class="hl--token hl--keyword">new</span> <span class="hl--token hl--class-name">Date</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--function">gtag</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">'config'</span><span class="hl--token hl--punctuation">,</span> trackingId<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

  <span class="hl--token hl--keyword hl--control-flow">try</span> <span class="hl--token hl--punctuation">{</span>
    <span class="hl--token hl--keyword hl--control-flow">await</span> <span class="hl--token hl--function">addGoogleAnalyticsScript</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--punctuation">}</span> <span class="hl--token hl--keyword hl--control-flow">catch</span> <span class="hl--token hl--punctuation">(</span>err<span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
    <span class="hl--token hl--console hl--class-name">console</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">error</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">'gtag failure'</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

    <span class="hl--token hl--keyword">const</span> s <span class="hl--token hl--operator">=</span> <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">getElementById</span><span class="hl--token hl--punctuation">(</span>scriptId<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

    <span class="hl--token hl--keyword hl--control-flow">if</span> <span class="hl--token hl--punctuation">(</span>s<span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
      s<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">remove</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
    <span class="hl--token hl--punctuation">}</span>

    <span class="hl--token hl--keyword hl--control-flow">return</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--punctuation">}</span>

  mounted <span class="hl--token hl--operator">=</span> <span class="hl--token hl--boolean">true</span><span class="hl--token hl--punctuation">;</span>
<span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
</code></pre></div>
  </pre>
<h3 id="detecting-page-changes-on-your-sapper-single-page-application" tabindex="-1"><a class="header-anchor" href="#detecting-page-changes-on-your-sapper-single-page-application">Detecting page changes on your Sapper single page application</a></h3>
<p>The library used to track on Google Analytics is called google tag manager (gtag). During the registration process on GA, you have seen a script that you could inject on your <code>template.html</code> of your sapper application. However, if you do that
you won't register pageview events when the user follows a sapper link.</p>
<blockquote>
<p>Sapper navigation is using the <a href="https://developer.mozilla.org/en-US/docs/Web/API/History" target="_blank">History API</a> of your browser. When the user follows a link, the framework picks the assets and preload the missing data. After that, it can render the view without redownloading the full page. That's one of the main benefits of using a Javascript framework with
routing capabilities.</p>
</blockquote>
<p>Sapper is prepared to handle this tracking giving us a <a href="https://sapper.svelte.dev/docs#Stores" target="_blank">module</a> that expose the <code>page</code>
<a href="https://svelte.dev/docs#svelte_store" target="_blank">store</a>. With this simple snippet, you will log the page path on every URL change.</p>
<pre class="terminal">
  <div class="bar bar-language-javascript">
    <div class="btn"></div>
    <div class="bar-title">javascript</div>
    <div><button class="button copy is-small is-pulled-right">Copy</button></div>  
  </div>
  <div class="body"><pre class="language-javascript"><code><span class="hl--token hl--keyword hl--module">import</span> <span class="hl--token hl--imports"><span class="hl--token hl--punctuation">{</span> stores <span class="hl--token hl--punctuation">}</span></span> <span class="hl--token hl--keyword hl--module">from</span> <span class="hl--token hl--string">'@sapper/app'</span><span class="hl--token hl--punctuation">;</span>
<span class="hl--token hl--keyword">const</span> <span class="hl--token hl--punctuation">{</span> page <span class="hl--token hl--punctuation">}</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--function">stores</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

<span class="hl--token hl--literal-property hl--property">$</span><span class="hl--token hl--operator">:</span> <span class="hl--token hl--punctuation">{</span>
  <span class="hl--token hl--keyword">const</span> page_path <span class="hl--token hl--operator">=</span> $page<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">path</span><span class="hl--token hl--punctuation">;</span>

  <span class="hl--token hl--console hl--class-name">console</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">log</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">{</span> page_path <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
<span class="hl--token hl--punctuation">}</span>
</code></pre></div>
  </pre>
<p>If we want to send the page view during navigation changes,
we can do so really easily just by calling our <code>gtag</code> function, that it's globally available on the window object.</p>
<pre class="terminal">
  <div class="bar bar-language-javascript">
    <div class="btn"></div>
    <div class="bar-title">javascript</div>
    <div><button class="button copy is-small is-pulled-right">Copy</button></div>  
  </div>
  <div class="body"><pre class="language-javascript"><code><span class="hl--token hl--keyword hl--module">import</span> <span class="hl--token hl--imports"><span class="hl--token hl--punctuation">{</span> stores <span class="hl--token hl--punctuation">}</span></span> <span class="hl--token hl--keyword hl--module">from</span> <span class="hl--token hl--string">'@sapper/app'</span><span class="hl--token hl--punctuation">;</span>
<span class="hl--token hl--keyword">const</span> <span class="hl--token hl--punctuation">{</span> page <span class="hl--token hl--punctuation">}</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--function">stores</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
<span class="hl--token hl--keyword">let</span> mounted <span class="hl--token hl--operator">=</span> <span class="hl--token hl--boolean">false</span><span class="hl--token hl--punctuation">;</span>

<span class="hl--token hl--comment">// Single page application handling</span>
<span class="hl--token hl--literal-property hl--property">$</span><span class="hl--token hl--operator">:</span> <span class="hl--token hl--punctuation">{</span>
  <span class="hl--token hl--keyword">const</span> page_path <span class="hl--token hl--operator">=</span> $page<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">path</span><span class="hl--token hl--punctuation">;</span>

  <span class="hl--token hl--keyword hl--control-flow">if</span> <span class="hl--token hl--punctuation">(</span>mounted <span class="hl--token hl--operator">&amp;&amp;</span> <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">gtag</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
    <span class="hl--token hl--function">gtag</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">'config'</span><span class="hl--token hl--punctuation">,</span> trackingId<span class="hl--token hl--punctuation">,</span> <span class="hl--token hl--punctuation">{</span> page_path <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--punctuation">}</span>
<span class="hl--token hl--punctuation">}</span>
</code></pre></div>
  </pre>
<h2 id="google-analytics-svelte-component" tabindex="-1"><a class="header-anchor" href="#google-analytics-svelte-component">Google Analytics svelte component</a></h2>
<p>Combining all the previous parts of the post, we will have a complete svelte component ready to be used on your root <code>_layout.svelte</code>.</p>
<pre class="terminal">
  <div class="bar bar-language-html">
    <div class="btn"></div>
    <div class="bar-title">html</div>
    <div><button class="button copy is-small is-pulled-right">Copy</button></div>  
  </div>
  <div class="body"><pre class="language-html"><code><span class="hl--token hl--tag"><span class="hl--token hl--tag"><span class="hl--token hl--punctuation">&lt;</span>script</span><span class="hl--token hl--punctuation">></span></span><span class="hl--token hl--script"><span class="hl--token hl--language-javascript">
  <span class="hl--token hl--keyword hl--module">import</span> <span class="hl--token hl--imports"><span class="hl--token hl--punctuation">{</span> stores <span class="hl--token hl--punctuation">}</span></span> <span class="hl--token hl--keyword hl--module">from</span> <span class="hl--token hl--string">'@sapper/app'</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--keyword hl--module">import</span> <span class="hl--token hl--imports"><span class="hl--token hl--punctuation">{</span> onMount <span class="hl--token hl--punctuation">}</span></span> <span class="hl--token hl--keyword hl--module">from</span> <span class="hl--token hl--string">'svelte'</span><span class="hl--token hl--punctuation">;</span>

  <span class="hl--token hl--comment">// Pass or harcode your google analytics tracking id</span>
  <span class="hl--token hl--keyword hl--module">export</span> <span class="hl--token hl--keyword">let</span> trackingId <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">'UA-000000-2'</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--keyword hl--module">export</span> <span class="hl--token hl--keyword">let</span> scriptId <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">'google-analytics-script'</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--keyword hl--module">export</span> <span class="hl--token hl--keyword">let</span> domain <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">'https://www.googletagmanager.com'</span><span class="hl--token hl--punctuation">;</span>

  <span class="hl--token hl--keyword">let</span> mounted <span class="hl--token hl--operator">=</span> <span class="hl--token hl--boolean">false</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--keyword">const</span> <span class="hl--token hl--punctuation">{</span> page <span class="hl--token hl--punctuation">}</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--function">stores</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

  <span class="hl--token hl--comment">// Adding google tag manager will fail for example if the user is running</span>
  <span class="hl--token hl--comment">// and ad blocker. This Promise can handle that case.</span>
  <span class="hl--token hl--keyword">async</span> <span class="hl--token hl--keyword">function</span> <span class="hl--token hl--function">addGoogleAnalyticsScript</span><span class="hl--token hl--punctuation">(</span>dataLayerName <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">'dataLayer'</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
    <span class="hl--token hl--keyword hl--control-flow">return</span> <span class="hl--token hl--keyword">new</span> <span class="hl--token hl--class-name">Promise</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--parameter">resolve<span class="hl--token hl--punctuation">,</span> reject</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--arrow hl--operator">=></span> <span class="hl--token hl--punctuation">{</span>
      <span class="hl--token hl--keyword">const</span> head <span class="hl--token hl--operator">=</span> <span class="hl--token hl--dom hl--variable">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">head</span> <span class="hl--token hl--operator">||</span> <span class="hl--token hl--dom hl--variable">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">getElementsByTagName</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">'head'</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">[</span><span class="hl--token hl--number">0</span><span class="hl--token hl--punctuation">]</span><span class="hl--token hl--punctuation">;</span>

      <span class="hl--token hl--keyword">const</span> link <span class="hl--token hl--operator">=</span> <span class="hl--token hl--dom hl--variable">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">createElement</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">'link'</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
      link<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">href</span> <span class="hl--token hl--operator">=</span> domain<span class="hl--token hl--punctuation">;</span>
      link<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">rel</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">'preconnect'</span><span class="hl--token hl--punctuation">;</span>
      head<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">appendChild</span><span class="hl--token hl--punctuation">(</span>link<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

      <span class="hl--token hl--keyword">const</span> script <span class="hl--token hl--operator">=</span> <span class="hl--token hl--dom hl--variable">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">createElement</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">'script'</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
      script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">async</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--boolean">true</span><span class="hl--token hl--punctuation">;</span>
      script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">src</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--template-string"><span class="hl--token hl--template-punctuation hl--string">`</span><span class="hl--token hl--interpolation"><span class="hl--token hl--interpolation-punctuation hl--punctuation">${</span>domain<span class="hl--token hl--interpolation-punctuation hl--punctuation">}</span></span><span class="hl--token hl--string">/gtag/js?id=</span><span class="hl--token hl--interpolation"><span class="hl--token hl--interpolation-punctuation hl--punctuation">${</span>trackingId<span class="hl--token hl--interpolation-punctuation hl--punctuation">}</span></span><span class="hl--token hl--string">&amp;l=</span><span class="hl--token hl--interpolation"><span class="hl--token hl--interpolation-punctuation hl--punctuation">${</span>dataLayerName<span class="hl--token hl--interpolation-punctuation hl--punctuation">}</span></span><span class="hl--token hl--template-punctuation hl--string">`</span></span><span class="hl--token hl--punctuation">;</span>
      script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">charset</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">'utf-8'</span><span class="hl--token hl--punctuation">;</span>
      script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">setAttribute</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">'id'</span><span class="hl--token hl--punctuation">,</span> scriptId<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

      head<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">appendChild</span><span class="hl--token hl--punctuation">(</span>script<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

      script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">onload</span> <span class="hl--token hl--operator">=</span> resolve<span class="hl--token hl--punctuation">;</span>
      script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">onerror</span> <span class="hl--token hl--operator">=</span> reject<span class="hl--token hl--punctuation">;</span>
    <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--punctuation">}</span>

  <span class="hl--token hl--function">onMount</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--keyword">async</span> <span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--arrow hl--operator">=></span> <span class="hl--token hl--punctuation">{</span>
    <span class="hl--token hl--comment">// We add the script only once even when the component rendered twice.</span>
    <span class="hl--token hl--keyword hl--control-flow">if</span> <span class="hl--token hl--punctuation">(</span><span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">getElementById</span><span class="hl--token hl--punctuation">(</span>scriptId<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
      <span class="hl--token hl--keyword hl--control-flow">return</span><span class="hl--token hl--punctuation">;</span>
    <span class="hl--token hl--punctuation">}</span>

    <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">dataLayer</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">dataLayer</span> <span class="hl--token hl--operator">||</span> <span class="hl--token hl--punctuation">[</span><span class="hl--token hl--punctuation">]</span><span class="hl--token hl--punctuation">;</span>
    <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method-variable hl--function-variable hl--method hl--function hl--property-access">gtag</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--keyword">function</span> <span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
      <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">dataLayer</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">push</span><span class="hl--token hl--punctuation">(</span>arguments<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
    <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">;</span>
    <span class="hl--token hl--function">gtag</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">'js'</span><span class="hl--token hl--punctuation">,</span> <span class="hl--token hl--keyword">new</span> <span class="hl--token hl--class-name">Date</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
    <span class="hl--token hl--function">gtag</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">'config'</span><span class="hl--token hl--punctuation">,</span> trackingId<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

    <span class="hl--token hl--keyword hl--control-flow">try</span> <span class="hl--token hl--punctuation">{</span>
      <span class="hl--token hl--keyword hl--control-flow">await</span> <span class="hl--token hl--function">addGoogleAnalyticsScript</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
    <span class="hl--token hl--punctuation">}</span> <span class="hl--token hl--keyword hl--control-flow">catch</span> <span class="hl--token hl--punctuation">(</span>err<span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
      <span class="hl--token hl--console hl--class-name">console</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">error</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">'gtag failure'</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

      <span class="hl--token hl--keyword">const</span> s <span class="hl--token hl--operator">=</span> <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">getElementById</span><span class="hl--token hl--punctuation">(</span>scriptId<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

      <span class="hl--token hl--keyword hl--control-flow">if</span> <span class="hl--token hl--punctuation">(</span>s<span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
        s<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--method hl--function hl--property-access">remove</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
      <span class="hl--token hl--punctuation">}</span>

      <span class="hl--token hl--keyword hl--control-flow">return</span><span class="hl--token hl--punctuation">;</span>
    <span class="hl--token hl--punctuation">}</span>

    mounted <span class="hl--token hl--operator">=</span> <span class="hl--token hl--boolean">true</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

  <span class="hl--token hl--comment">// Single page application handling</span>
  <span class="hl--token hl--literal-property hl--property">$</span><span class="hl--token hl--operator">:</span> <span class="hl--token hl--punctuation">{</span>
    <span class="hl--token hl--keyword">const</span> page_path <span class="hl--token hl--operator">=</span> $page<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">path</span><span class="hl--token hl--punctuation">;</span>

    <span class="hl--token hl--keyword hl--control-flow">if</span> <span class="hl--token hl--punctuation">(</span>mounted <span class="hl--token hl--operator">&amp;&amp;</span> <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">gtag</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
      <span class="hl--token hl--function">gtag</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">'config'</span><span class="hl--token hl--punctuation">,</span> trackingId<span class="hl--token hl--punctuation">,</span> <span class="hl--token hl--punctuation">{</span> page_path <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
    <span class="hl--token hl--punctuation">}</span>
  <span class="hl--token hl--punctuation">}</span>
</span></span><span class="hl--token hl--tag"><span class="hl--token hl--tag"><span class="hl--token hl--punctuation">&lt;/</span>script</span><span class="hl--token hl--punctuation">></span></span>
</code></pre></div>
  </pre>
<!-- HTML_TAG_END -->
  </div>

  <div class="is-hidden-print"><hr>

  <div><div class="has-text-centered"><div><span class="has-text-weight-bold has-text-centered has-text-grey-dark">Share
        </span></div>
      <div class="icons-container svelte-ralcnf"><a href="https://twitter.com/intent/tweet?url=https://angelblanco.dev/articles/add-gtag-analytics-to-sapper/&amp;text=Add%20Google%20Analytics&#39;%20gtag%20to%20a%20Sapper%20project&amp;via=angelblancodev" target="__blank" class="icon is-large" aria-label="Share on Twitter"><i class="fab fa-2x fa-twitter svelte-ralcnf"></i>
          </a><a href="https://wwww.facebook.com/sharer.php?u=https://angelblanco.dev/articles/add-gtag-analytics-to-sapper/&amp;t=Add%20Google%20Analytics&#39;%20gtag%20to%20a%20Sapper%20project" target="__blank" class="icon is-large" aria-label="Share on Facebook"><i class="fab fa-2x fa-facebook svelte-ralcnf"></i>
          </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https://angelblanco.dev/articles/add-gtag-analytics-to-sapper/" target="__blank" class="icon is-large" aria-label="Share on Linkedin"><i class="fab fa-2x fa-linkedin-in svelte-ralcnf"></i>
          </a></div></div></div>

  
</div></section>

<section class="section reading-width is-hidden-print" id="comments"><h3 class="title is-3">Comments</h3>

  <div id="disqus_thread"></div></section>

<div class="afterArticleContainer svelte-1xs3w5z"></div>

</div></main>

<footer class="footer info svelte-1vimzui" aria-hidden="true"><hr class="footerRule is-hidden-print svelte-1vimzui">

  <div class="has-text-centered"><p class="has-text-grey-light is-family-monospace svelte-1vimzui">Personal website of <a href="/about/" class="has-text-grey-dark svelte-1vimzui">Ángel Blanco</a></p>

    <p class="footer-github is-hidden-print svelte-1vimzui"><a href="https://github.com/angelblanco/angelblanco.dev" class="button svelte-1vimzui" target="__blank"><span class="icon"><span class="fab fa-github"></span></span>

        <span>Developed by Ángel Blanco hosted on Github</span></a></p>

    <div class="libraries-box is-m-auto is-hidden-print svelte-1vimzui"><div class="box"><p class="has-text-grey-light is-family-monospace svelte-1vimzui">This project <i class="fas fa-heart svelte-1vimzui"></i> this libraries
        </p>

        <div class="field is-grouped is-grouped-multiline is-m-auto justify-center"><div class="control"><div class="tags has-addons"><span class="tag is-dark">framework</span>
                <a href="https://kit.svelte.dev/" class="tag is-light svelte-1vimzui">svelte-kit</a></div>
            </div><div class="control"><div class="tags has-addons"><span class="tag is-dark">css</span>
                <a href="https://bulma.io/" class="tag is-light svelte-1vimzui">bulma</a></div>
            </div><div class="control"><div class="tags has-addons"><span class="tag is-dark">js</span>
                <a href="https://svelte.dev/" class="tag is-light svelte-1vimzui">svelte</a></div>
            </div><div class="control"><div class="tags has-addons"><span class="tag is-dark">bundler</span>
                <a href="https://rollupjs.org/" class="tag is-light svelte-1vimzui">rollup</a></div>
            </div><div class="control"><div class="tags has-addons"><span class="tag is-dark">md</span>
                <a href="https://github.com/markdown-it/markdown-it" class="tag is-light svelte-1vimzui">markdown-it</a></div>
            </div></div>

        <p class="has-text-grey-light is-family-monospace is-size-7 svelte-1vimzui">And all of <a class="has-decoration-underline has-text-grey-dark svelte-1vimzui" href="/libraries/" rel="preload">these...</a></p></div></div></div>
</footer>


		<script type="module" data-hydrate="1jrt3mq">
		import { start } from "/_app/start-f8140ddd.js";
		start({
			target: document.querySelector('[data-hydrate="1jrt3mq"]').parentNode,
			paths: {"base":"","assets":""},
			session: {},
			route: true,
			spa: false,
			trailing_slash: "ignore",
			hydrate: {
				status: 200,
				error: null,
				nodes: [
					import("/_app/pages/__layout.svelte-97c00a7f.js"),
						import("/_app/pages/articles/__layout.svelte-e94d3e2a.js"),
						import("/_app/pages/articles/_slug_.svelte-5a52e418.js")
				],
				params: {slug:"add-gtag-analytics-to-sapper"}
			}
		});
	</script><script type="application/json" sveltekit:data-type="data" sveltekit:data-url="/api/articles/add-gtag-analytics-to-sapper">{"status":200,"statusText":"","headers":{"content-type":"application/json; charset=utf-8"},"body":"{\"id\":5,\"type\":\"article\",\"tweet\":null,\"slug\":\"add-gtag-analytics-to-sapper\",\"url\":\"/articles/add-gtag-analytics-to-sapper/\",\"title\":\"Add Google Analytics' gtag to a Sapper project\",\"intro\":\"\u003Cp>Adding Google Analytics support to a single page application that changes the URL on the client-side could be tricky. It's not as simple as adding tracking to a server-side rendered application that refreshes its scripts on every page hit.\u003C/p>\\n\u003Cp>To get the real flow of a user across your Sapper website, you need to track all the URL changes that happen when the user follows a Svelte link. Let's simplify the tracking of the pageview event on Sapper with a component without using any third party library!\u003C/p>\\n\",\"description\":\"Step by step guide to create a component that tracks your sapper application every time the user changes its URL with virtual page views.\",\"tags\":[\"svelte\",\"js\",\"blog\"],\"date\":\"October 28, 2020\",\"readingTimeText\":\"5 min read\",\"readingTimeMinutes\":4.88,\"words\":976,\"note\":false,\"shortLink\":\"/go/YS01\",\"toc\":{\"tree\":[{\"level\":2,\"title\":\"In-depth tutorial\",\"anchor\":\"#in-depth-tutorial\",\"children\":[{\"level\":3,\"title\":\"Before start steps\",\"anchor\":\"#before-start-steps\",\"children\":[]},{\"level\":3,\"title\":\"Insert the google script on the page with vanilla JS\",\"anchor\":\"#insert-the-google-script-on-the-page-with-vanilla-js\",\"children\":[]},{\"level\":3,\"title\":\"Track the first hit of your web page\",\"anchor\":\"#track-the-first-hit-of-your-web-page\",\"children\":[]},{\"level\":3,\"title\":\"Detecting page changes on your Sapper single page application\",\"anchor\":\"#detecting-page-changes-on-your-sapper-single-page-application\",\"children\":[]}]},{\"level\":2,\"title\":\"Google Analytics svelte component\",\"anchor\":\"#google-analytics-svelte-component\",\"children\":[]}],\"plain\":[{\"level\":2,\"title\":\"In-depth tutorial\",\"anchor\":\"#in-depth-tutorial\"},{\"level\":3,\"title\":\"Before start steps\",\"anchor\":\"#before-start-steps\"},{\"level\":3,\"title\":\"Insert the google script on the page with vanilla JS\",\"anchor\":\"#insert-the-google-script-on-the-page-with-vanilla-js\"},{\"level\":3,\"title\":\"Track the first hit of your web page\",\"anchor\":\"#track-the-first-hit-of-your-web-page\"},{\"level\":3,\"title\":\"Detecting page changes on your Sapper single page application\",\"anchor\":\"#detecting-page-changes-on-your-sapper-single-page-application\"},{\"level\":2,\"title\":\"Google Analytics svelte component\",\"anchor\":\"#google-analytics-svelte-component\"}]},\"meta\":{\"id\":5,\"title\":\"Add Google Analytics' gtag to a Sapper project\",\"share_tweet\":\"Add Google Analytics' gtag to sapper with @sveltejs\",\"tweet\":\"\",\"date\":\"2020-10-28T00:00:00.000Z\",\"description\":\"Step by step guide to create a component that tracks your sapper application every time the user changes its URL with virtual page views.\",\"intro\":\"Adding Google Analytics support to a single page application that changes the URL on the client-side could be tricky. It's not as simple as adding tracking to a server-side rendered application that refreshes its scripts on every page hit.\\n\\nTo get the real flow of a user across your Sapper website, you need to track all the URL changes that happen when the user follows a Svelte link. Let's simplify the tracking of the pageview event on Sapper with a component without using any third party library!\\n\",\"tags\":[\"svelte\",\"js\",\"blog\"],\"published\":true,\"slug\":\"add-gtag-analytics-to-sapper\",\"titleSlug\":\"add-google-analytics-gtag-to-a-sapper-project\",\"readingStats\":{\"text\":\"5 min read\",\"minutes\":4.88,\"time\":292800,\"words\":976}},\"html\":\"\u003Ch2 id=\\\"in-depth-tutorial\\\" tabindex=\\\"-1\\\">\u003Ca class=\\\"header-anchor\\\" href=\\\"#in-depth-tutorial\\\">In-depth tutorial\u003C/a>\u003C/h2>\\n\u003Cp>In this first part of the tutorial, I will try to explain how to approach the inclusion of any third party script with a custom component. Note that sometimes including it on your \u003Ccode>template.html\u003C/code> will have you covered.\u003C/p>\\n\u003Cblockquote>\\n\u003Cp>If you have a tracking id and want to skip this reading, please go directly to\\n\u003Ca href=\\\"#google-analytics-svelte-component\\\">Google Analytics Svelte component\u003C/a>.\u003C/p>\\n\u003C/blockquote>\\n\u003Ch3 id=\\\"before-start-steps\\\" tabindex=\\\"-1\\\">\u003Ca class=\\\"header-anchor\\\" href=\\\"#before-start-steps\\\">Before start steps\u003C/a>\u003C/h3>\\n\u003Cp>First of all, you need to register your domain on \u003Ca href=\\\"https://analytics.google.com/\\\" target=\\\"_blank\\\">Google Analytics\u003C/a>. Following all the desired steps, you will have access to a tracking id. The number we should have will look like \u003Ccode>UA-000000-2\u003C/code>. Don't worry, if you lose it you will have access to it on the Admin section of your property.\u003C/p>\\n\u003Ch3 id=\\\"insert-the-google-script-on-the-page-with-vanilla-js\\\" tabindex=\\\"-1\\\">\u003Ca class=\\\"header-anchor\\\" href=\\\"#insert-the-google-script-on-the-page-with-vanilla-js\\\">Insert the google script on the page with vanilla JS\u003C/a>\u003C/h3>\\n\u003Cp>We cannot inject a script with \u003Ccode>src\u003C/code> on our Svelte component template. Even if we could do so, it will not be as great as having all the control in your component. So what we are going to create a script element with Javascript, assigning it a unique identifier and mount it to the end of the document body.\u003C/p>\\n\u003Cp>As sapper ships with ES6 support out of the box and promises are supported, we will create one that resolves or rejects based on the script execution. This way, we can perform actions on error like removing the script on connection issues or when an adblocker is disabling \u003Ccode>gtag\u003C/code>.\u003C/p>\\n\u003Cpre class=\\\"terminal\\\">\\n  \u003Cdiv class=\\\"bar bar-language-javascript\\\">\\n    \u003Cdiv class=\\\"btn\\\">\u003C/div>\\n    \u003Cdiv class=\\\"bar-title\\\">javascript\u003C/div>\\n    \u003Cdiv>\u003Cbutton class=\\\"button copy is-small is-pulled-right\\\">Copy\u003C/button>\u003C/div>  \\n  \u003C/div>\\n  \u003Cdiv class=\\\"body\\\">\u003Cpre class=\\\"language-javascript\\\">\u003Ccode>\u003Cspan class=\\\"hl--token hl--keyword hl--module\\\">export\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword\\\">let\u003C/span> domain \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--string\\\">'https://www.googletagmanager.com'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\u003Cspan class=\\\"hl--token hl--keyword hl--module\\\">export\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword\\\">let\u003C/span> scriptId \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--string\\\">'google-analytics-script'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\u003Cspan class=\\\"hl--token hl--keyword hl--module\\\">export\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword\\\">let\u003C/span> trackingId \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--string\\\">'UA-000000-2'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n\u003Cspan class=\\\"hl--token hl--keyword\\\">async\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword\\\">function\u003C/span> \u003Cspan class=\\\"hl--token hl--function\\\">addGoogleAnalyticsScript\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>dataLayerName \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--string\\\">'dataLayer'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--keyword hl--control-flow\\\">return\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword\\\">new\u003C/span> \u003Cspan class=\\\"hl--token hl--class-name\\\">Promise\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--parameter\\\">resolve\u003Cspan class=\\\"hl--token hl--punctuation\\\">,\u003C/span> reject\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span> \u003Cspan class=\\\"hl--token hl--arrow hl--operator\\\">=>\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span>\\n    \u003Cspan class=\\\"hl--token hl--keyword\\\">const\u003C/span> head \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--dom hl--variable\\\">document\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">head\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">||\u003C/span> \u003Cspan class=\\\"hl--token hl--dom hl--variable\\\">document\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">getElementsByTagName\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--string\\\">'head'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">[\u003C/span>\u003Cspan class=\\\"hl--token hl--number\\\">0\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">]\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n    \u003Cspan class=\\\"hl--token hl--keyword\\\">const\u003C/span> link \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--dom hl--variable\\\">document\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">createElement\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--string\\\">'link'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n    link\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">href\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> domain\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n    link\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">rel\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--string\\\">'preconnect'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n    head\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">appendChild\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>link\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n    \u003Cspan class=\\\"hl--token hl--keyword\\\">const\u003C/span> script \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--dom hl--variable\\\">document\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">createElement\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--string\\\">'script'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n    script\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">async\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--boolean\\\">true\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n    script\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">src\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--template-string\\\">\u003Cspan class=\\\"hl--token hl--template-punctuation hl--string\\\">`\u003C/span>\u003Cspan class=\\\"hl--token hl--interpolation\\\">\u003Cspan class=\\\"hl--token hl--interpolation-punctuation hl--punctuation\\\">${\u003C/span>domain\u003Cspan class=\\\"hl--token hl--interpolation-punctuation hl--punctuation\\\">}\u003C/span>\u003C/span>\u003Cspan class=\\\"hl--token hl--string\\\">/gtag/js?id=\u003C/span>\u003Cspan class=\\\"hl--token hl--interpolation\\\">\u003Cspan class=\\\"hl--token hl--interpolation-punctuation hl--punctuation\\\">${\u003C/span>trackingId\u003Cspan class=\\\"hl--token hl--interpolation-punctuation hl--punctuation\\\">}\u003C/span>\u003C/span>\u003Cspan class=\\\"hl--token hl--string\\\">&amp;l=\u003C/span>\u003Cspan class=\\\"hl--token hl--interpolation\\\">\u003Cspan class=\\\"hl--token hl--interpolation-punctuation hl--punctuation\\\">${\u003C/span>dataLayerName\u003Cspan class=\\\"hl--token hl--interpolation-punctuation hl--punctuation\\\">}\u003C/span>\u003C/span>\u003Cspan class=\\\"hl--token hl--template-punctuation hl--string\\\">`\u003C/span>\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n    script\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">charset\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--string\\\">'utf-8'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n    script\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">setAttribute\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--string\\\">'id'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">,\u003C/span> scriptId\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n    head\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">appendChild\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>script\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n    script\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">onload\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> resolve\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n    script\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">onerror\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> reject\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\\n\u003C/code>\u003C/pre>\u003C/div>\\n  \u003C/pre>\\n\u003Ch3 id=\\\"track-the-first-hit-of-your-web-page\\\" tabindex=\\\"-1\\\">\u003Ca class=\\\"header-anchor\\\" href=\\\"#track-the-first-hit-of-your-web-page\\\">Track the first hit of your web page\u003C/a>\u003C/h3>\\n\u003Cp>Google Analytics tracking will happen on the client-side. That means that we must prepare our component tracking to happen only when mounted.\\nDue to it, we will use a flag \u003Ccode>mounted\u003C/code> that will tell if Google Analytics script has mounted successfully in a previous URL.\u003C/p>\\n\u003Cp>On failure, we will remove the script just in case you want to create some retrying mechanism. Note that by default, Sapper applications ship with a \u003Ca href=\\\"https://developer.mozilla.org/es/docs/Web/API/Service_Worker_API\\\" target=\\\"_blank\\\">Service Worker\u003C/a> that will have you covered in some cases when the client loses its internet connection. In this case, we are logging the error and removing the script.\u003C/p>\\n\u003Cpre class=\\\"terminal\\\">\\n  \u003Cdiv class=\\\"bar bar-language-javascript\\\">\\n    \u003Cdiv class=\\\"btn\\\">\u003C/div>\\n    \u003Cdiv class=\\\"bar-title\\\">javascript\u003C/div>\\n    \u003Cdiv>\u003Cbutton class=\\\"button copy is-small is-pulled-right\\\">Copy\u003C/button>\u003C/div>  \\n  \u003C/div>\\n  \u003Cdiv class=\\\"body\\\">\u003Cpre class=\\\"language-javascript\\\">\u003Ccode>\u003Cspan class=\\\"hl--token hl--keyword hl--module\\\">import\u003C/span> \u003Cspan class=\\\"hl--token hl--imports\\\">\u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span> onMount \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword hl--module\\\">from\u003C/span> \u003Cspan class=\\\"hl--token hl--string\\\">'svelte'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\u003Cspan class=\\\"hl--token hl--keyword hl--module\\\">export\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword\\\">let\u003C/span> scriptId \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--string\\\">'google-analytics-script'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\u003Cspan class=\\\"hl--token hl--keyword hl--module\\\">export\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword\\\">let\u003C/span> trackingId \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--string\\\">'UA-000000-2'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n\u003Cspan class=\\\"hl--token hl--keyword\\\">let\u003C/span> mounted \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--boolean\\\">false\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n\u003Cspan class=\\\"hl--token hl--function\\\">onMount\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--keyword\\\">async\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span> \u003Cspan class=\\\"hl--token hl--arrow hl--operator\\\">=>\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--keyword hl--control-flow\\\">if\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--dom hl--variable\\\">window\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">document\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">getElementById\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>scriptId\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span>\\n    \u003Cspan class=\\\"hl--token hl--keyword hl--control-flow\\\">return\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\\n\\n  \u003Cspan class=\\\"hl--token hl--dom hl--variable\\\">window\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">dataLayer\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--dom hl--variable\\\">window\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">dataLayer\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">||\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">[\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">]\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--dom hl--variable\\\">window\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method-variable hl--function-variable hl--method hl--function hl--property-access\\\">gtag\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword\\\">function\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span>\\n    \u003Cspan class=\\\"hl--token hl--dom hl--variable\\\">window\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">dataLayer\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">push\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>arguments\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--function\\\">gtag\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--string\\\">'js'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">,\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword\\\">new\u003C/span> \u003Cspan class=\\\"hl--token hl--class-name\\\">Date\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--function\\\">gtag\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--string\\\">'config'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">,\u003C/span> trackingId\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n  \u003Cspan class=\\\"hl--token hl--keyword hl--control-flow\\\">try\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span>\\n    \u003Cspan class=\\\"hl--token hl--keyword hl--control-flow\\\">await\u003C/span> \u003Cspan class=\\\"hl--token hl--function\\\">addGoogleAnalyticsScript\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword hl--control-flow\\\">catch\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>err\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span>\\n    \u003Cspan class=\\\"hl--token hl--console hl--class-name\\\">console\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">error\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--string\\\">'gtag failure'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n    \u003Cspan class=\\\"hl--token hl--keyword\\\">const\u003C/span> s \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--dom hl--variable\\\">window\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">document\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">getElementById\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>scriptId\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n    \u003Cspan class=\\\"hl--token hl--keyword hl--control-flow\\\">if\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>s\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span>\\n      s\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">remove\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n    \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\\n\\n    \u003Cspan class=\\\"hl--token hl--keyword hl--control-flow\\\">return\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\\n\\n  mounted \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--boolean\\\">true\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\u003C/code>\u003C/pre>\u003C/div>\\n  \u003C/pre>\\n\u003Ch3 id=\\\"detecting-page-changes-on-your-sapper-single-page-application\\\" tabindex=\\\"-1\\\">\u003Ca class=\\\"header-anchor\\\" href=\\\"#detecting-page-changes-on-your-sapper-single-page-application\\\">Detecting page changes on your Sapper single page application\u003C/a>\u003C/h3>\\n\u003Cp>The library used to track on Google Analytics is called google tag manager (gtag). During the registration process on GA, you have seen a script that you could inject on your \u003Ccode>template.html\u003C/code> of your sapper application. However, if you do that\\nyou won't register pageview events when the user follows a sapper link.\u003C/p>\\n\u003Cblockquote>\\n\u003Cp>Sapper navigation is using the \u003Ca href=\\\"https://developer.mozilla.org/en-US/docs/Web/API/History\\\" target=\\\"_blank\\\">History API\u003C/a> of your browser. When the user follows a link, the framework picks the assets and preload the missing data. After that, it can render the view without redownloading the full page. That's one of the main benefits of using a Javascript framework with\\nrouting capabilities.\u003C/p>\\n\u003C/blockquote>\\n\u003Cp>Sapper is prepared to handle this tracking giving us a \u003Ca href=\\\"https://sapper.svelte.dev/docs#Stores\\\" target=\\\"_blank\\\">module\u003C/a> that expose the \u003Ccode>page\u003C/code>\\n\u003Ca href=\\\"https://svelte.dev/docs#svelte_store\\\" target=\\\"_blank\\\">store\u003C/a>. With this simple snippet, you will log the page path on every URL change.\u003C/p>\\n\u003Cpre class=\\\"terminal\\\">\\n  \u003Cdiv class=\\\"bar bar-language-javascript\\\">\\n    \u003Cdiv class=\\\"btn\\\">\u003C/div>\\n    \u003Cdiv class=\\\"bar-title\\\">javascript\u003C/div>\\n    \u003Cdiv>\u003Cbutton class=\\\"button copy is-small is-pulled-right\\\">Copy\u003C/button>\u003C/div>  \\n  \u003C/div>\\n  \u003Cdiv class=\\\"body\\\">\u003Cpre class=\\\"language-javascript\\\">\u003Ccode>\u003Cspan class=\\\"hl--token hl--keyword hl--module\\\">import\u003C/span> \u003Cspan class=\\\"hl--token hl--imports\\\">\u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span> stores \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword hl--module\\\">from\u003C/span> \u003Cspan class=\\\"hl--token hl--string\\\">'@sapper/app'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\u003Cspan class=\\\"hl--token hl--keyword\\\">const\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span> page \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--function\\\">stores\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n\u003Cspan class=\\\"hl--token hl--literal-property hl--property\\\">$\u003C/span>\u003Cspan class=\\\"hl--token hl--operator\\\">:\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--keyword\\\">const\u003C/span> page_path \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> $page\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">path\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n  \u003Cspan class=\\\"hl--token hl--console hl--class-name\\\">console\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">log\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span> page_path \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\\n\u003C/code>\u003C/pre>\u003C/div>\\n  \u003C/pre>\\n\u003Cp>If we want to send the page view during navigation changes,\\nwe can do so really easily just by calling our \u003Ccode>gtag\u003C/code> function, that it's globally available on the window object.\u003C/p>\\n\u003Cpre class=\\\"terminal\\\">\\n  \u003Cdiv class=\\\"bar bar-language-javascript\\\">\\n    \u003Cdiv class=\\\"btn\\\">\u003C/div>\\n    \u003Cdiv class=\\\"bar-title\\\">javascript\u003C/div>\\n    \u003Cdiv>\u003Cbutton class=\\\"button copy is-small is-pulled-right\\\">Copy\u003C/button>\u003C/div>  \\n  \u003C/div>\\n  \u003Cdiv class=\\\"body\\\">\u003Cpre class=\\\"language-javascript\\\">\u003Ccode>\u003Cspan class=\\\"hl--token hl--keyword hl--module\\\">import\u003C/span> \u003Cspan class=\\\"hl--token hl--imports\\\">\u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span> stores \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword hl--module\\\">from\u003C/span> \u003Cspan class=\\\"hl--token hl--string\\\">'@sapper/app'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\u003Cspan class=\\\"hl--token hl--keyword\\\">const\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span> page \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--function\\\">stores\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\u003Cspan class=\\\"hl--token hl--keyword\\\">let\u003C/span> mounted \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--boolean\\\">false\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n\u003Cspan class=\\\"hl--token hl--comment\\\">// Single page application handling\u003C/span>\\n\u003Cspan class=\\\"hl--token hl--literal-property hl--property\\\">$\u003C/span>\u003Cspan class=\\\"hl--token hl--operator\\\">:\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--keyword\\\">const\u003C/span> page_path \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> $page\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">path\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n  \u003Cspan class=\\\"hl--token hl--keyword hl--control-flow\\\">if\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>mounted \u003Cspan class=\\\"hl--token hl--operator\\\">&amp;&amp;\u003C/span> \u003Cspan class=\\\"hl--token hl--dom hl--variable\\\">window\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">gtag\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span>\\n    \u003Cspan class=\\\"hl--token hl--function\\\">gtag\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--string\\\">'config'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">,\u003C/span> trackingId\u003Cspan class=\\\"hl--token hl--punctuation\\\">,\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span> page_path \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\\n\u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\\n\u003C/code>\u003C/pre>\u003C/div>\\n  \u003C/pre>\\n\u003Ch2 id=\\\"google-analytics-svelte-component\\\" tabindex=\\\"-1\\\">\u003Ca class=\\\"header-anchor\\\" href=\\\"#google-analytics-svelte-component\\\">Google Analytics svelte component\u003C/a>\u003C/h2>\\n\u003Cp>Combining all the previous parts of the post, we will have a complete svelte component ready to be used on your root \u003Ccode>_layout.svelte\u003C/code>.\u003C/p>\\n\u003Cpre class=\\\"terminal\\\">\\n  \u003Cdiv class=\\\"bar bar-language-html\\\">\\n    \u003Cdiv class=\\\"btn\\\">\u003C/div>\\n    \u003Cdiv class=\\\"bar-title\\\">html\u003C/div>\\n    \u003Cdiv>\u003Cbutton class=\\\"button copy is-small is-pulled-right\\\">Copy\u003C/button>\u003C/div>  \\n  \u003C/div>\\n  \u003Cdiv class=\\\"body\\\">\u003Cpre class=\\\"language-html\\\">\u003Ccode>\u003Cspan class=\\\"hl--token hl--tag\\\">\u003Cspan class=\\\"hl--token hl--tag\\\">\u003Cspan class=\\\"hl--token hl--punctuation\\\">&lt;\u003C/span>script\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">>\u003C/span>\u003C/span>\u003Cspan class=\\\"hl--token hl--script\\\">\u003Cspan class=\\\"hl--token hl--language-javascript\\\">\\n  \u003Cspan class=\\\"hl--token hl--keyword hl--module\\\">import\u003C/span> \u003Cspan class=\\\"hl--token hl--imports\\\">\u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span> stores \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword hl--module\\\">from\u003C/span> \u003Cspan class=\\\"hl--token hl--string\\\">'@sapper/app'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--keyword hl--module\\\">import\u003C/span> \u003Cspan class=\\\"hl--token hl--imports\\\">\u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span> onMount \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword hl--module\\\">from\u003C/span> \u003Cspan class=\\\"hl--token hl--string\\\">'svelte'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n  \u003Cspan class=\\\"hl--token hl--comment\\\">// Pass or harcode your google analytics tracking id\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--keyword hl--module\\\">export\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword\\\">let\u003C/span> trackingId \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--string\\\">'UA-000000-2'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--keyword hl--module\\\">export\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword\\\">let\u003C/span> scriptId \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--string\\\">'google-analytics-script'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--keyword hl--module\\\">export\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword\\\">let\u003C/span> domain \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--string\\\">'https://www.googletagmanager.com'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n  \u003Cspan class=\\\"hl--token hl--keyword\\\">let\u003C/span> mounted \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--boolean\\\">false\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--keyword\\\">const\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span> page \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--function\\\">stores\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n  \u003Cspan class=\\\"hl--token hl--comment\\\">// Adding google tag manager will fail for example if the user is running\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--comment\\\">// and ad blocker. This Promise can handle that case.\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--keyword\\\">async\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword\\\">function\u003C/span> \u003Cspan class=\\\"hl--token hl--function\\\">addGoogleAnalyticsScript\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>dataLayerName \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--string\\\">'dataLayer'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span>\\n    \u003Cspan class=\\\"hl--token hl--keyword hl--control-flow\\\">return\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword\\\">new\u003C/span> \u003Cspan class=\\\"hl--token hl--class-name\\\">Promise\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--parameter\\\">resolve\u003Cspan class=\\\"hl--token hl--punctuation\\\">,\u003C/span> reject\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span> \u003Cspan class=\\\"hl--token hl--arrow hl--operator\\\">=>\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span>\\n      \u003Cspan class=\\\"hl--token hl--keyword\\\">const\u003C/span> head \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--dom hl--variable\\\">document\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">head\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">||\u003C/span> \u003Cspan class=\\\"hl--token hl--dom hl--variable\\\">document\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">getElementsByTagName\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--string\\\">'head'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">[\u003C/span>\u003Cspan class=\\\"hl--token hl--number\\\">0\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">]\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n      \u003Cspan class=\\\"hl--token hl--keyword\\\">const\u003C/span> link \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--dom hl--variable\\\">document\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">createElement\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--string\\\">'link'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n      link\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">href\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> domain\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n      link\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">rel\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--string\\\">'preconnect'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n      head\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">appendChild\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>link\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n      \u003Cspan class=\\\"hl--token hl--keyword\\\">const\u003C/span> script \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--dom hl--variable\\\">document\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">createElement\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--string\\\">'script'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n      script\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">async\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--boolean\\\">true\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n      script\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">src\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--template-string\\\">\u003Cspan class=\\\"hl--token hl--template-punctuation hl--string\\\">`\u003C/span>\u003Cspan class=\\\"hl--token hl--interpolation\\\">\u003Cspan class=\\\"hl--token hl--interpolation-punctuation hl--punctuation\\\">${\u003C/span>domain\u003Cspan class=\\\"hl--token hl--interpolation-punctuation hl--punctuation\\\">}\u003C/span>\u003C/span>\u003Cspan class=\\\"hl--token hl--string\\\">/gtag/js?id=\u003C/span>\u003Cspan class=\\\"hl--token hl--interpolation\\\">\u003Cspan class=\\\"hl--token hl--interpolation-punctuation hl--punctuation\\\">${\u003C/span>trackingId\u003Cspan class=\\\"hl--token hl--interpolation-punctuation hl--punctuation\\\">}\u003C/span>\u003C/span>\u003Cspan class=\\\"hl--token hl--string\\\">&amp;l=\u003C/span>\u003Cspan class=\\\"hl--token hl--interpolation\\\">\u003Cspan class=\\\"hl--token hl--interpolation-punctuation hl--punctuation\\\">${\u003C/span>dataLayerName\u003Cspan class=\\\"hl--token hl--interpolation-punctuation hl--punctuation\\\">}\u003C/span>\u003C/span>\u003Cspan class=\\\"hl--token hl--template-punctuation hl--string\\\">`\u003C/span>\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n      script\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">charset\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--string\\\">'utf-8'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n      script\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">setAttribute\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--string\\\">'id'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">,\u003C/span> scriptId\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n      head\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">appendChild\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>script\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n      script\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">onload\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> resolve\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n      script\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">onerror\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> reject\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n    \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\\n\\n  \u003Cspan class=\\\"hl--token hl--function\\\">onMount\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--keyword\\\">async\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span> \u003Cspan class=\\\"hl--token hl--arrow hl--operator\\\">=>\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span>\\n    \u003Cspan class=\\\"hl--token hl--comment\\\">// We add the script only once even when the component rendered twice.\u003C/span>\\n    \u003Cspan class=\\\"hl--token hl--keyword hl--control-flow\\\">if\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--dom hl--variable\\\">window\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">document\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">getElementById\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>scriptId\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span>\\n      \u003Cspan class=\\\"hl--token hl--keyword hl--control-flow\\\">return\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n    \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\\n\\n    \u003Cspan class=\\\"hl--token hl--dom hl--variable\\\">window\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">dataLayer\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--dom hl--variable\\\">window\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">dataLayer\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">||\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">[\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">]\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n    \u003Cspan class=\\\"hl--token hl--dom hl--variable\\\">window\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method-variable hl--function-variable hl--method hl--function hl--property-access\\\">gtag\u003C/span> \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword\\\">function\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span>\\n      \u003Cspan class=\\\"hl--token hl--dom hl--variable\\\">window\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">dataLayer\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">push\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>arguments\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n    \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n    \u003Cspan class=\\\"hl--token hl--function\\\">gtag\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--string\\\">'js'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">,\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword\\\">new\u003C/span> \u003Cspan class=\\\"hl--token hl--class-name\\\">Date\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n    \u003Cspan class=\\\"hl--token hl--function\\\">gtag\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--string\\\">'config'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">,\u003C/span> trackingId\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n    \u003Cspan class=\\\"hl--token hl--keyword hl--control-flow\\\">try\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span>\\n      \u003Cspan class=\\\"hl--token hl--keyword hl--control-flow\\\">await\u003C/span> \u003Cspan class=\\\"hl--token hl--function\\\">addGoogleAnalyticsScript\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n    \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span> \u003Cspan class=\\\"hl--token hl--keyword hl--control-flow\\\">catch\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>err\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span>\\n      \u003Cspan class=\\\"hl--token hl--console hl--class-name\\\">console\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">error\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--string\\\">'gtag failure'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n      \u003Cspan class=\\\"hl--token hl--keyword\\\">const\u003C/span> s \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--dom hl--variable\\\">window\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">document\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">getElementById\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>scriptId\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n      \u003Cspan class=\\\"hl--token hl--keyword hl--control-flow\\\">if\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>s\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span>\\n        s\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--method hl--function hl--property-access\\\">remove\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n      \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\\n\\n      \u003Cspan class=\\\"hl--token hl--keyword hl--control-flow\\\">return\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n    \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\\n\\n    mounted \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> \u003Cspan class=\\\"hl--token hl--boolean\\\">true\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n  \u003Cspan class=\\\"hl--token hl--comment\\\">// Single page application handling\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--literal-property hl--property\\\">$\u003C/span>\u003Cspan class=\\\"hl--token hl--operator\\\">:\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span>\\n    \u003Cspan class=\\\"hl--token hl--keyword\\\">const\u003C/span> page_path \u003Cspan class=\\\"hl--token hl--operator\\\">=\u003C/span> $page\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">path\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n\\n    \u003Cspan class=\\\"hl--token hl--keyword hl--control-flow\\\">if\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>mounted \u003Cspan class=\\\"hl--token hl--operator\\\">&amp;&amp;\u003C/span> \u003Cspan class=\\\"hl--token hl--dom hl--variable\\\">window\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">.\u003C/span>\u003Cspan class=\\\"hl--token hl--property-access\\\">gtag\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span>\\n      \u003Cspan class=\\\"hl--token hl--function\\\">gtag\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">(\u003C/span>\u003Cspan class=\\\"hl--token hl--string\\\">'config'\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">,\u003C/span> trackingId\u003Cspan class=\\\"hl--token hl--punctuation\\\">,\u003C/span> \u003Cspan class=\\\"hl--token hl--punctuation\\\">{\u003C/span> page_path \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">)\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">;\u003C/span>\\n    \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\\n  \u003Cspan class=\\\"hl--token hl--punctuation\\\">}\u003C/span>\\n\u003C/span>\u003C/span>\u003Cspan class=\\\"hl--token hl--tag\\\">\u003Cspan class=\\\"hl--token hl--tag\\\">\u003Cspan class=\\\"hl--token hl--punctuation\\\">&lt;/\u003C/span>script\u003C/span>\u003Cspan class=\\\"hl--token hl--punctuation\\\">>\u003C/span>\u003C/span>\\n\u003C/code>\u003C/pre>\u003C/div>\\n  \u003C/pre>\\n\"}"}</script>
  </body>
</html>
