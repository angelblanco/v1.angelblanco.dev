<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <base href=/ > <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <title>Add Google Analytics' gtag to a Sapper project - Angel Blanco's blog</title><meta content="Step by step guide to create a component that tracks your sapper application every time the user changes its URL with virtual page views." data-svelte=svelte-1xb68rj name=description><meta content=https://angelblanco.dev/articles/add-gtag-analytics-to-sapper/ data-svelte=svelte-1xb68rj property=og:url><meta content="Add Google Analytics' gtag to a Sapper project" data-svelte=svelte-1xb68rj property=og:title><meta content="Step by step guide to create a component that tracks your sapper application every time the user changes its URL with virtual page views." data-svelte=svelte-1xb68rj property=og:description><meta content=https://angelblanco.dev/images/share-default.png data-svelte=svelte-1xb68rj property=og:image><meta content=1200 data-svelte=svelte-1xb68rj property=og:image:width><meta content=630 data-svelte=svelte-1xb68rj property=og:image:height><meta content=en_US data-svelte=svelte-1xb68rj property=og:locale><meta content="Ángel Blanco" data-svelte=svelte-1xb68rj property=og:author><meta content="Add Google Analytics' gtag to a Sapper project" data-svelte=svelte-1xb68rj name=twitter:title><meta content="Step by step guide to create a component that tracks your sapper application every time the user changes its URL with virtual page views." data-svelte=svelte-1xb68rj name=twitter:description><meta content=summary_large_image data-svelte=svelte-1xb68rj name=twitter:card><meta content=@angelblancodev data-svelte=svelte-1xb68rj name=twitter:site><meta content=@angelblancodev data-svelte=svelte-1xb68rj name=twitter:creator><meta content=https://angelblanco.dev/images/share-default.png data-svelte=svelte-1xb68rj name=twitter:image> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,{},(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){return {article:{id:c,type:"article",tweet:null,slug:d,url:e,title:f,intro:"\u003Cp\u003EAdding Google Analytics support to a single page application that changes the URL on the client-side could be tricky. It's not as simple as adding tracking to a server-side rendered application that refreshes its scripts on every page hit.\u003C\u002Fp\u003E\n\u003Cp\u003ETo get the real flow of a user across your Sapper website, you need to track all the URL changes that happen when the user follows a Svelte link. Let's simplify the tracking of the pageview event on Sapper with a component without using any third party library!\u003C\u002Fp\u003E\n",description:g,tags:[h,i,j],date:"October 28, 2020",readingTimeText:k,readingTimeMinutes:l,words:m,note:false,shortLink:"\u002Fgo\u002FYS01",toc:{tree:[{level:b,title:n,anchor:o,children:[{level:a,title:p,anchor:q,children:[]},{level:a,title:r,anchor:s,children:[]},{level:a,title:t,anchor:u,children:[]},{level:a,title:v,anchor:w,children:[]}]},{level:b,title:x,anchor:y,children:[]}],plain:[{level:b,title:n,anchor:o},{level:a,title:p,anchor:q},{level:a,title:r,anchor:s},{level:a,title:t,anchor:u},{level:a,title:v,anchor:w},{level:b,title:x,anchor:y}]},meta:{id:c,title:f,share_tweet:"Add Google Analytics' gtag to sapper with @sveltejs",tweet:"",date:"2020-10-28T00:00:00.000Z",description:g,intro:"Adding Google Analytics support to a single page application that changes the URL on the client-side could be tricky. It's not as simple as adding tracking to a server-side rendered application that refreshes its scripts on every page hit.\n\nTo get the real flow of a user across your Sapper website, you need to track all the URL changes that happen when the user follows a Svelte link. Let's simplify the tracking of the pageview event on Sapper with a component without using any third party library! \n",tags:[h,i,j],published:true,slug:d,titleSlug:"add-google-analytics-gtag-to-a-sapper-project",readingStats:{text:k,minutes:l,time:292800,words:m}},html:"\u003Ch2 id=\"in-depth-tutorial\"\u003EIn-depth tutorial\u003C\u002Fh2\u003E\n\u003Cp\u003EIn this first part of the tutorial, I will try to explain how to approach the inclusion of any third party script with a custom component. Note that sometimes including it on your \u003Ccode\u003Etemplate.html\u003C\u002Fcode\u003E will have you covered.\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003EIf you have a tracking id and want to skip this reading, please go directly to\n\u003Ca href=\"#google-analytics-svelte-component\"\u003EGoogle Analytics Svelte component\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Ch3 id=\"before-start-steps\"\u003EBefore start steps\u003C\u002Fh3\u003E\n\u003Cp\u003EFirst of all, you need to register your domain on \u003Ca href=\"https:\u002F\u002Fanalytics.google.com\u002F\" target=\"_blank\"\u003EGoogle Analytics\u003C\u002Fa\u003E. Following all the desired steps, you will have access to a tracking id. The number we should have will look like \u003Ccode\u003EUA-000000-2\u003C\u002Fcode\u003E. Don't worry, if you lose it you will have access to it on the Admin section of your property.\u003C\u002Fp\u003E\n\u003Ch3 id=\"insert-the-google-script-on-the-page-with-vanilla-js\"\u003EInsert the google script on the page with vanilla JS\u003C\u002Fh3\u003E\n\u003Cp\u003EWe cannot inject a script with \u003Ccode\u003Esrc\u003C\u002Fcode\u003E on our Svelte component template. Even if we could do so, it will not be as great as having all the control in your component. So what we are going to create a script element with Javascript, assigning it a unique identifier and mount it to the end of the document body.\u003C\u002Fp\u003E\n\u003Cp\u003EAs sapper ships with ES6 support out of the box and promises are supported, we will create one that resolves or rejects based on the script execution. This way, we can perform actions on error like removing the script on connection issues or when an adblocker is disabling \u003Ccode\u003Egtag\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Cpre class=\"terminal\"\u003E\n  \u003Cdiv class=\"bar bar-language-javascript\"\u003E\n    \u003Cdiv class=\"btn\"\u003E\u003C\u002Fdiv\u003E\n    \u003Cdiv class=\"bar-title\"\u003Ejavascript\u003C\u002Fdiv\u003E\n    \u003Cdiv\u003E\u003Cbutton class=\"button copy is-small is-pulled-right\"\u003ECopy\u003C\u002Fbutton\u003E\u003C\u002Fdiv\u003E  \n  \u003C\u002Fdiv\u003E\n  \u003Cdiv class=\"body\"\u003E\u003Cpre class=\"language-javascript\"\u003E\u003Ccode\u003E\u003Cspan class=\"hl--token hl--keyword hl--module\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword\"\u003Elet\u003C\u002Fspan\u003E domain \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E\"https:\u002F\u002Fwww.googletagmanager.com\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hl--token hl--keyword hl--module\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword\"\u003Elet\u003C\u002Fspan\u003E scriptId \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E\"google-analytics-script\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hl--token hl--keyword hl--module\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword\"\u003Elet\u003C\u002Fspan\u003E trackingId \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E\"UA-000000-2\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hl--token hl--keyword\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--function\"\u003EaddGoogleAnalyticsScript\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003EdataLayerName \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E\"dataLayer\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--class-name\"\u003EPromise\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--parameter\"\u003Eresolve\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E reject\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--arrow hl--operator\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E head \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Edocument\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Ehead\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E||\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Edocument\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003EgetElementsByTagName\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E\"head\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E link \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Edocument\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003EcreateElement\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E\"link\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n    link\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Ehref\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E domain\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n    link\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Erel\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E\"preconnect\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n    head\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003EappendChild\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003Elink\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E script \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Edocument\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003EcreateElement\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E\"script\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n    script\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--boolean\"\u003Etrue\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n    script\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Esrc\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--template-string\"\u003E\u003Cspan class=\"hl--token hl--template-punctuation hl--string\"\u003E`\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--interpolation\"\u003E\u003Cspan class=\"hl--token hl--interpolation-punctuation hl--punctuation\"\u003E${\u003C\u002Fspan\u003Edomain\u003Cspan class=\"hl--token hl--interpolation-punctuation hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E\u002Fgtag\u002Fjs?id=\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--interpolation\"\u003E\u003Cspan class=\"hl--token hl--interpolation-punctuation hl--punctuation\"\u003E${\u003C\u002Fspan\u003EtrackingId\u003Cspan class=\"hl--token hl--interpolation-punctuation hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E&amp;l=\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--interpolation\"\u003E\u003Cspan class=\"hl--token hl--interpolation-punctuation hl--punctuation\"\u003E${\u003C\u002Fspan\u003EdataLayerName\u003Cspan class=\"hl--token hl--interpolation-punctuation hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--template-punctuation hl--string\"\u003E`\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n    script\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Echarset\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E\"utf-8\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n    script\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003EsetAttribute\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E\"id\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E scriptId\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n    head\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003EappendChild\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003Escript\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n    script\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Eonload\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E resolve\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n    script\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Eonerror\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E reject\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n  \u003C\u002Fpre\u003E\n\u003Ch3 id=\"track-the-first-hit-of-your-web-page\"\u003ETrack the first hit of your web page\u003C\u002Fh3\u003E\n\u003Cp\u003EGoogle Analytics tracking will happen on the client-side. That means that we must prepare our component tracking to happen only when mounted.\nDue to it, we will use a flag \u003Ccode\u003Emounted\u003C\u002Fcode\u003E that will tell if Google Analytics script has mounted successfully in a previous URL.\u003C\u002Fp\u003E\n\u003Cp\u003EOn failure, we will remove the script just in case you want to create some retrying mechanism. Note that by default, Sapper applications ship with a \u003Ca href=\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fes\u002Fdocs\u002FWeb\u002FAPI\u002FService_Worker_API\" target=\"_blank\"\u003EService Worker\u003C\u002Fa\u003E that will have you covered in some cases when the client loses its internet connection. In this case, we are logging the error and removing the script.\u003C\u002Fp\u003E\n\u003Cpre class=\"terminal\"\u003E\n  \u003Cdiv class=\"bar bar-language-javascript\"\u003E\n    \u003Cdiv class=\"btn\"\u003E\u003C\u002Fdiv\u003E\n    \u003Cdiv class=\"bar-title\"\u003Ejavascript\u003C\u002Fdiv\u003E\n    \u003Cdiv\u003E\u003Cbutton class=\"button copy is-small is-pulled-right\"\u003ECopy\u003C\u002Fbutton\u003E\u003C\u002Fdiv\u003E  \n  \u003C\u002Fdiv\u003E\n  \u003Cdiv class=\"body\"\u003E\u003Cpre class=\"language-javascript\"\u003E\u003Ccode\u003E\u003Cspan class=\"hl--token hl--keyword hl--module\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--imports\"\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E onMount \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword hl--module\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E\"svelte\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hl--token hl--keyword hl--module\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword\"\u003Elet\u003C\u002Fspan\u003E scriptId \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E\"google-analytics-script\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hl--token hl--keyword hl--module\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword\"\u003Elet\u003C\u002Fspan\u003E trackingId \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E\"UA-000000-2\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hl--token hl--keyword\"\u003Elet\u003C\u002Fspan\u003E mounted \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--boolean\"\u003Efalse\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hl--token hl--function\"\u003EonMount\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--keyword\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--arrow hl--operator\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Ewindow\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Edocument\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003EgetElementById\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003EscriptId\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Ereturn\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Ewindow\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003EdataLayer\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Ewindow\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003EdataLayer\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E||\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Ewindow\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method-variable hl--function-variable hl--method hl--function hl--property-access\"\u003Egtag\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Ewindow\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003EdataLayer\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Epush\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003Earguments\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--function\"\u003Egtag\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E\"js\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--class-name\"\u003EDate\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--function\"\u003Egtag\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E\"config\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E trackingId\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Etry\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Eawait\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--function\"\u003EaddGoogleAnalyticsScript\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Ecatch\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003Eerr\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--console hl--class-name\"\u003Econsole\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Eerror\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E\"gtag failure\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E s \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Ewindow\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Edocument\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003EgetElementById\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003EscriptId\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003Es\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n      s\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Eremove\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Ereturn\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\n\n  mounted \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--boolean\"\u003Etrue\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n  \u003C\u002Fpre\u003E\n\u003Ch3 id=\"detecting-page-changes-on-your-sapper-single-page-application\"\u003EDetecting page changes on your Sapper single page application\u003C\u002Fh3\u003E\n\u003Cp\u003EThe library used to track on Google Analytics is called google tag manager (gtag). During the registration process on GA, you have seen a script that you could inject on your \u003Ccode\u003Etemplate.html\u003C\u002Fcode\u003E of your sapper application. However, if you do that\nyou won't register pageview events when the user follows a sapper link.\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003ESapper navigation is using the \u003Ca href=\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FAPI\u002FHistory\" target=\"_blank\"\u003EHistory API\u003C\u002Fa\u003E of your browser. When the user follows a link, the framework picks the assets and preload the missing data. After that, it can render the view without redownloading the full page. That's one of the main benefits of using a Javascript framework with\nrouting capabilities.\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cp\u003ESapper is prepared to handle this tracking giving us a \u003Ca href=\"https:\u002F\u002Fsapper.svelte.dev\u002Fdocs#Stores\" target=\"_blank\"\u003Emodule\u003C\u002Fa\u003E that expose the \u003Ccode\u003Epage\u003C\u002Fcode\u003E\n\u003Ca href=\"https:\u002F\u002Fsvelte.dev\u002Fdocs#svelte_store\" target=\"_blank\"\u003Estore\u003C\u002Fa\u003E. With this simple snippet, you will log the page path on every URL change.\u003C\u002Fp\u003E\n\u003Cpre class=\"terminal\"\u003E\n  \u003Cdiv class=\"bar bar-language-javascript\"\u003E\n    \u003Cdiv class=\"btn\"\u003E\u003C\u002Fdiv\u003E\n    \u003Cdiv class=\"bar-title\"\u003Ejavascript\u003C\u002Fdiv\u003E\n    \u003Cdiv\u003E\u003Cbutton class=\"button copy is-small is-pulled-right\"\u003ECopy\u003C\u002Fbutton\u003E\u003C\u002Fdiv\u003E  \n  \u003C\u002Fdiv\u003E\n  \u003Cdiv class=\"body\"\u003E\u003Cpre class=\"language-javascript\"\u003E\u003Ccode\u003E\u003Cspan class=\"hl--token hl--keyword hl--module\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--imports\"\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E stores \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword hl--module\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E\"@sapper\u002Fapp\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E page \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--function\"\u003Estores\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n$\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E page_path \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E $page\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Epath\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"hl--token hl--console hl--class-name\"\u003Econsole\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E page_path \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E   \n\u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n  \u003C\u002Fpre\u003E\n\u003Cp\u003EIf we want to send the page view during navigation changes,\nwe can do so really easily just by calling our \u003Ccode\u003Egtag\u003C\u002Fcode\u003E function, that it's globally available on the window object.\u003C\u002Fp\u003E\n\u003Cpre class=\"terminal\"\u003E\n  \u003Cdiv class=\"bar bar-language-javascript\"\u003E\n    \u003Cdiv class=\"btn\"\u003E\u003C\u002Fdiv\u003E\n    \u003Cdiv class=\"bar-title\"\u003Ejavascript\u003C\u002Fdiv\u003E\n    \u003Cdiv\u003E\u003Cbutton class=\"button copy is-small is-pulled-right\"\u003ECopy\u003C\u002Fbutton\u003E\u003C\u002Fdiv\u003E  \n  \u003C\u002Fdiv\u003E\n  \u003Cdiv class=\"body\"\u003E\u003Cpre class=\"language-javascript\"\u003E\u003Ccode\u003E\u003Cspan class=\"hl--token hl--keyword hl--module\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--imports\"\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E stores \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword hl--module\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E\"@sapper\u002Fapp\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E page \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--function\"\u003Estores\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hl--token hl--keyword\"\u003Elet\u003C\u002Fspan\u003E mounted \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--boolean\"\u003Efalse\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hl--token hl--comment\"\u003E\u002F\u002F Single page application handling\u003C\u002Fspan\u003E\n$\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E page_path \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E $page\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Epath\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003Emounted \u003Cspan class=\"hl--token hl--operator\"\u003E&amp;&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Ewindow\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Egtag\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--function\"\u003Egtag\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E\"config\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E trackingId\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E page_path \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n  \u003C\u002Fpre\u003E\n\u003Ch2 id=\"google-analytics-svelte-component\"\u003EGoogle Analytics svelte component\u003C\u002Fh2\u003E\n\u003Cp\u003ECombining all the previous parts of the post, we will have a  complete svelte component ready to be used on your root \u003Ccode\u003E_layout.svelte\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Cpre class=\"terminal\"\u003E\n  \u003Cdiv class=\"bar bar-language-html\"\u003E\n    \u003Cdiv class=\"btn\"\u003E\u003C\u002Fdiv\u003E\n    \u003Cdiv class=\"bar-title\"\u003Ehtml\u003C\u002Fdiv\u003E\n    \u003Cdiv\u003E\u003Cbutton class=\"button copy is-small is-pulled-right\"\u003ECopy\u003C\u002Fbutton\u003E\u003C\u002Fdiv\u003E  \n  \u003C\u002Fdiv\u003E\n  \u003Cdiv class=\"body\"\u003E\u003Cpre class=\"language-html\"\u003E\u003Ccode\u003E\u003Cspan class=\"hl--token hl--tag\"\u003E\u003Cspan class=\"hl--token hl--tag\"\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E&lt;\u003C\u002Fspan\u003Escript\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--script\"\u003E\u003Cspan class=\"hl--token hl--language-javascript\"\u003E\n  \u003Cspan class=\"hl--token hl--keyword hl--module\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--imports\"\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E stores \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword hl--module\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E\"@sapper\u002Fapp\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--keyword hl--module\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--imports\"\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E onMount \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword hl--module\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E\"svelte\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"hl--token hl--comment\"\u003E\u002F\u002F Pass or harcode your google analytics tracking id\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--keyword hl--module\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword\"\u003Elet\u003C\u002Fspan\u003E trackingId \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E\"UA-000000-2\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--keyword hl--module\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword\"\u003Elet\u003C\u002Fspan\u003E scriptId \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E\"google-analytics-script\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--keyword hl--module\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword\"\u003Elet\u003C\u002Fspan\u003E domain \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E\"https:\u002F\u002Fwww.googletagmanager.com\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"hl--token hl--keyword\"\u003Elet\u003C\u002Fspan\u003E mounted \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--boolean\"\u003Efalse\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E page \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--function\"\u003Estores\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"hl--token hl--comment\"\u003E\u002F\u002F Adding google tag manager will fail for example if the user is running \u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--comment\"\u003E\u002F\u002F and ad blocker. This Promise can handle that case.\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--keyword\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--function\"\u003EaddGoogleAnalyticsScript\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003EdataLayerName \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E\"dataLayer\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--class-name\"\u003EPromise\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--parameter\"\u003Eresolve\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E reject\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--arrow hl--operator\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E head \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Edocument\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Ehead\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E||\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Edocument\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003EgetElementsByTagName\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E\"head\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n      \u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E link \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Edocument\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003EcreateElement\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E\"link\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n      link\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Ehref\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E domain\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n      link\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Erel\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E\"preconnect\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n      head\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003EappendChild\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003Elink\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n      \u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E script \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Edocument\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003EcreateElement\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E\"script\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n      script\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--boolean\"\u003Etrue\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n      script\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Esrc\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--template-string\"\u003E\u003Cspan class=\"hl--token hl--template-punctuation hl--string\"\u003E`\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--interpolation\"\u003E\u003Cspan class=\"hl--token hl--interpolation-punctuation hl--punctuation\"\u003E${\u003C\u002Fspan\u003Edomain\u003Cspan class=\"hl--token hl--interpolation-punctuation hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E\u002Fgtag\u002Fjs?id=\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--interpolation\"\u003E\u003Cspan class=\"hl--token hl--interpolation-punctuation hl--punctuation\"\u003E${\u003C\u002Fspan\u003EtrackingId\u003Cspan class=\"hl--token hl--interpolation-punctuation hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E&amp;l=\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--interpolation\"\u003E\u003Cspan class=\"hl--token hl--interpolation-punctuation hl--punctuation\"\u003E${\u003C\u002Fspan\u003EdataLayerName\u003Cspan class=\"hl--token hl--interpolation-punctuation hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--template-punctuation hl--string\"\u003E`\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n      script\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Echarset\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--string\"\u003E\"utf-8\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n      script\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003EsetAttribute\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E\"id\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E scriptId\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n      head\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003EappendChild\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003Escript\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n      script\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Eonload\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E resolve\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n      script\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Eonerror\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E reject\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"hl--token hl--function\"\u003EonMount\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--keyword\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--arrow hl--operator\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--comment\"\u003E\u002F\u002F We add the script only once even when the component rendered twice.\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Ewindow\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Edocument\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003EgetElementById\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003EscriptId\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Ereturn\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Ewindow\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003EdataLayer\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Ewindow\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003EdataLayer\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E||\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Ewindow\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method-variable hl--function-variable hl--method hl--function hl--property-access\"\u003Egtag\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Ewindow\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003EdataLayer\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Epush\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003Earguments\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--function\"\u003Egtag\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E\"js\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--class-name\"\u003EDate\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--function\"\u003Egtag\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E\"config\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E trackingId\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Etry\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Eawait\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--function\"\u003EaddGoogleAnalyticsScript\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Ecatch\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003Eerr\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hl--token hl--console hl--class-name\"\u003Econsole\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Eerror\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E\"gtag failure\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n      \u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E s \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Ewindow\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Edocument\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003EgetElementById\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003EscriptId\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n      \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003Es\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n        s\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--method hl--function hl--property-access\"\u003Eremove\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\n\n      \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Ereturn\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\n\n    mounted \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--boolean\"\u003Etrue\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"hl--token hl--comment\"\u003E\u002F\u002F Single page application handling\u003C\u002Fspan\u003E\n  $\u003Cspan class=\"hl--token hl--operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--keyword\"\u003Econst\u003C\u002Fspan\u003E page_path \u003Cspan class=\"hl--token hl--operator\"\u003E=\u003C\u002Fspan\u003E $page\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Epath\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"hl--token hl--keyword hl--control-flow\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003Emounted \u003Cspan class=\"hl--token hl--operator\"\u003E&amp;&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--dom hl--variable\"\u003Ewindow\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--property-access\"\u003Egtag\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hl--token hl--function\"\u003Egtag\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--string\"\u003E\"config\"\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E trackingId\u003Cspan class=\"hl--token hl--punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"hl--token hl--punctuation\"\u003E{\u003C\u002Fspan\u003E page_path \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hl--token hl--punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--tag\"\u003E\u003Cspan class=\"hl--token hl--tag\"\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E&lt;\u002F\u003C\u002Fspan\u003Escript\u003C\u002Fspan\u003E\u003Cspan class=\"hl--token hl--punctuation\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n  \u003C\u002Fpre\u003E\n"},path:e}}(3,2,5,"add-gtag-analytics-to-sapper","\u002Farticles\u002Fadd-gtag-analytics-to-sapper\u002F","Add Google Analytics' gtag to a Sapper project","Step by step guide to create a component that tracks your sapper application every time the user changes its URL with virtual page views.","svelte","js","blog","5 min read",4.88,976,"In-depth tutorial","#in-depth-tutorial","Before start steps","#before-start-steps","Insert the google script on the page with vanilla JS","#insert-the-google-script-on-the-page-with-vanilla-js","Track the first hit of your web page","#track-the-first-hit-of-your-web-page","Detecting page changes on your Sapper single page application","#detecting-page-changes-on-your-sapper-single-page-application","Google Analytics svelte component","#google-analytics-svelte-component"))]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.fd899e00.js"}catch(e){main="/client/legacy/client.24511f87.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@2.0.4.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> <link href=client/client-61a6edb8.css rel=stylesheet><link href=client/TinyLetterSubscribeForm-818d548a.css rel=stylesheet><link href=client/[slug]-f01695a6.css rel=stylesheet> <link href=/client/client.fd899e00.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/client-61a6edb8.css rel=preload as=style><link href=/client/[slug].a3f510bc.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/Tags.9833da3f.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/Head.9f27e168.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/Content.2512f3d4.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/TinyLetterSubscribeForm.56a8aae9.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/inject_styles.5607aec6.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/TinyLetterSubscribeForm-818d548a.css rel=preload as=style><link href=/client/[slug]-f01695a6.css rel=preload as=style></head> <body> <div id=sapper> <nav aria-label="main navigation" class="is-hidden-print container navbar" role=navigation><div class=navbar-brand><a href=/ class="navbar-item svelte-1qp23hj"><div class="image is-24x24" style=margin-right:10px><img alt="Angel Blanco's blog" src=/images/me-128x128.jpeg class=is-rounded></div> <img alt=logo src=/logo.png height=24 width=160></a> <span class="burger navbar-burger" aria-expanded=false aria-label=menu data-target=navbarBasicExample role=button><span aria-hidden=true></span> <span aria-hidden=true></span> <span aria-hidden=true></span></span></div> <div class=navbar-menu><div class=navbar-end><a href=articles/ class="navbar-item svelte-1qp23hj is-primary is-active" rel=prefetch>Articles </a> <a href=about/ class="navbar-item svelte-1qp23hj is-primary" rel=prefecth>About </a> <a href=https://github.com/angelblanco class="navbar-item svelte-1qp23hj" target=__blank><span class="icon is-hidden-touch"><i class="fab fa-lg fa-github-alt"></i></span> <span class=is-hidden-desktop>Github</span></a></div></div></nav> <div class="is-hidden-print back-to-top hidden svelte-1d29tie"><span class="icon is-large"><i class="fas fa-2x fa-chevron-up svelte-1d29tie"></i></span></div> <main class=blog><div class=container> <section class="reading-width section pb-0"><article class=media><figure class=media-left><a href=/about/ class="image is-64x64" rel=prefecth><img alt=user src=/images/me-128x128.jpeg class=is-rounded></a></figure> <div class=media-content><div class=container><p><a href=/about/ rel=prefetch><strong>Ángel Blanco</strong></a> <span class="has-text-grey-light is-size-7 date-subtitle svelte-ys8pd">2020-10-28 · 5 min read</span></p> <p>Tagged in:</div> <div class=tags><a href=/tag/svelte/ class="tag is-light svelte" rel=prefetch>Svelte</a><a href=/tag/js/ class="tag is-light js" rel=prefetch>Javascript</a><a href=/tag/blog/ class="tag is-light blog" rel=prefetch>Blog</a></div></div> <div class=media-right></div></article></section> <div class="hidden nprogress svelte-8m52ta" style="transition:opacity .3s linear"><div class="bar svelte-8m52ta" style="margin-left:-100%;transition:all .3s linear"></div></div> <div class="svelte-1uubpsp article-sidebar-overlay hidden"><div class="svelte-1uubpsp reading-width section"><div class="svelte-1uubpsp sidebar"><div class="svelte-1uubpsp has-text-align-left social-icons"><div class=is-clearfix><a href="https://twitter.com/intent/tweet?url=https://angelblanco.dev/articles/add-gtag-analytics-to-sapper/&text=Add%20Google%20Analytics'%20gtag%20to%20a%20Sapper%20project&via=angelblancodev" class="is-small button svelte-1uubpsp" target=__blank><span class="is-small icon svelte-1uubpsp"><i class="svelte-1uubpsp fab fa-twitter"></i></span> <span>Share on Twitter</span></a> </div><div class=is-clearfix><a href="https://wwww.facebook.com/sharer.php?u=https://angelblanco.dev/articles/add-gtag-analytics-to-sapper/&t=Add%20Google%20Analytics'%20gtag%20to%20a%20Sapper%20project" class="is-small button svelte-1uubpsp" target=__blank><span class="is-small icon svelte-1uubpsp"><i class="svelte-1uubpsp fab fa-facebook"></i></span> <span>Share on Facebook</span></a> </div><div class=is-clearfix><a href="https://www.linkedin.com/sharing/share-offsite/?url=https://angelblanco.dev/articles/add-gtag-analytics-to-sapper/" class="is-small button svelte-1uubpsp" target=__blank><span class="is-small icon svelte-1uubpsp"><i class="svelte-1uubpsp fab fa-linkedin-in"></i></span> <span>Share on Linkedin</span></a> </div> <div class=is-clearfix><button class="is-small button svelte-1uubpsp"><span class="is-small icon svelte-1uubpsp"><i class="svelte-1uubpsp fas fa-comments"></i></span> <span>Go Comments</span></button></div> <div class=is-clearfix><button class="is-small button svelte-1uubpsp"><span class="is-small icon svelte-1uubpsp"><i class="svelte-1uubpsp fas fa-share-alt"></i></span> <span class=svelte-1uubpsp>Share to clipboard</span></button></div></div></div></div></div> <section class="reading-width section"><h1 class="title is-1">Add Google Analytics' gtag to a Sapper project</h1> <div class="is-medium blog content"> <p>Adding Google Analytics support to a single page application that changes the URL on the client-side could be tricky. It's not as simple as adding tracking to a server-side rendered application that refreshes its scripts on every page hit.</p> <p>To get the real flow of a user across your Sapper website, you need to track all the URL changes that happen when the user follows a Svelte link. Let's simplify the tracking of the pageview event on Sapper with a component without using any third party library!</p> </div> <div class="svelte-1kd5tix box toc"><div class=menu><p class="menu-label has-text-info">On this article</p> <ul class=menu-list><li><a href=/articles/add-gtag-analytics-to-sapper/#in-depth-tutorial class=svelte-1kd5tix><span class="is-small icon anchor has-text-info svelte-1kd5tix"><i class="fas fa-hashtag"></i></span> In-depth tutorial</a> <ul><li><a href=/articles/add-gtag-analytics-to-sapper/#in-depth-tutorial class=svelte-1kd5tix><span class="is-small icon anchor has-text-info svelte-1kd5tix"><i class="fas fa-hashtag"></i></span> Before start steps</a> <li><a href=/articles/add-gtag-analytics-to-sapper/#in-depth-tutorial class=svelte-1kd5tix><span class="is-small icon anchor has-text-info svelte-1kd5tix"><i class="fas fa-hashtag"></i></span> Insert the google script on the page with vanilla JS</a> <li><a href=/articles/add-gtag-analytics-to-sapper/#in-depth-tutorial class=svelte-1kd5tix><span class="is-small icon anchor has-text-info svelte-1kd5tix"><i class="fas fa-hashtag"></i></span> Track the first hit of your web page</a> <li><a href=/articles/add-gtag-analytics-to-sapper/#in-depth-tutorial class=svelte-1kd5tix><span class="is-small icon anchor has-text-info svelte-1kd5tix"><i class="fas fa-hashtag"></i></span> Detecting page changes on your Sapper single page application</a> </li> </ul> <li><a href=/articles/add-gtag-analytics-to-sapper/#google-analytics-svelte-component class=svelte-1kd5tix><span class="is-small icon anchor has-text-info svelte-1kd5tix"><i class="fas fa-hashtag"></i></span> Google Analytics svelte component</a> </ul></div></div> <div class="is-medium blog content articleBody"> <h2 id=in-depth-tutorial>In-depth tutorial</h2> <p>In this first part of the tutorial, I will try to explain how to approach the inclusion of any third party script with a custom component. Note that sometimes including it on your <code>template.html</code> will have you covered.</p> <blockquote> <p>If you have a tracking id and want to skip this reading, please go directly to <a href=#google-analytics-svelte-component>Google Analytics Svelte component</a>.</p> </blockquote> <h3 id=before-start-steps>Before start steps</h3> <p>First of all, you need to register your domain on <a href=https://analytics.google.com/ target=_blank>Google Analytics</a>. Following all the desired steps, you will have access to a tracking id. The number we should have will look like <code>UA-000000-2</code>. Don't worry, if you lose it you will have access to it on the Admin section of your property.</p> <h3 id=insert-the-google-script-on-the-page-with-vanilla-js>Insert the google script on the page with vanilla JS</h3> <p>We cannot inject a script with <code>src</code> on our Svelte component template. Even if we could do so, it will not be as great as having all the control in your component. So what we are going to create a script element with Javascript, assigning it a unique identifier and mount it to the end of the document body.</p> <p>As sapper ships with ES6 support out of the box and promises are supported, we will create one that resolves or rejects based on the script execution. This way, we can perform actions on error like removing the script on connection issues or when an adblocker is disabling <code>gtag</code>.</p> <pre class=terminal>
  <div class="bar bar-language-javascript">
    <div class=btn></div>
    <div class=bar-title>javascript</div>
    <div><button class="is-small button copy is-pulled-right">Copy</button></div>  
  </div>
  <div class=body><pre class=language-javascript><code><span class="hl--token hl--keyword hl--module">export</span> <span class="hl--token hl--keyword">let</span> domain <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">"https://www.googletagmanager.com"</span><span class="hl--token hl--punctuation">;</span>
<span class="hl--token hl--keyword hl--module">export</span> <span class="hl--token hl--keyword">let</span> scriptId <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">"google-analytics-script"</span><span class="hl--token hl--punctuation">;</span>
<span class="hl--token hl--keyword hl--module">export</span> <span class="hl--token hl--keyword">let</span> trackingId <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">"UA-000000-2"</span><span class="hl--token hl--punctuation">;</span>

<span class="hl--token hl--keyword">async</span> <span class="hl--token hl--keyword">function</span> <span class="hl--token hl--function">addGoogleAnalyticsScript</span><span class="hl--token hl--punctuation">(</span>dataLayerName <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">"dataLayer"</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
  <span class="hl--token hl--keyword hl--control-flow">return</span> <span class="hl--token hl--keyword">new</span> <span class="hl--token hl--class-name">Promise</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--parameter">resolve<span class="hl--token hl--punctuation">,</span> reject</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--operator hl--arrow">=></span> <span class="hl--token hl--punctuation">{</span>
    <span class="hl--token hl--keyword">const</span> head <span class="hl--token hl--operator">=</span> <span class="hl--token hl--dom hl--variable">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">head</span> <span class="hl--token hl--operator">||</span> <span class="hl--token hl--dom hl--variable">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">getElementsByTagName</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">"head"</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">[</span><span class="hl--token hl--number">0</span><span class="hl--token hl--punctuation">]</span><span class="hl--token hl--punctuation">;</span>

    <span class="hl--token hl--keyword">const</span> link <span class="hl--token hl--operator">=</span> <span class="hl--token hl--dom hl--variable">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">createElement</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">"link"</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
    link<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">href</span> <span class="hl--token hl--operator">=</span> domain<span class="hl--token hl--punctuation">;</span>
    link<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">rel</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">"preconnect"</span><span class="hl--token hl--punctuation">;</span>
    head<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">appendChild</span><span class="hl--token hl--punctuation">(</span>link<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

    <span class="hl--token hl--keyword">const</span> script <span class="hl--token hl--operator">=</span> <span class="hl--token hl--dom hl--variable">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">createElement</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">"script"</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
    script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">async</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--boolean">true</span><span class="hl--token hl--punctuation">;</span>
    script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">src</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--template-string"><span class="hl--token hl--string hl--template-punctuation">`</span><span class="hl--token hl--interpolation"><span class="hl--token hl--punctuation hl--interpolation-punctuation">${</span>domain<span class="hl--token hl--punctuation hl--interpolation-punctuation">}</span></span><span class="hl--token hl--string">/gtag/js?id=</span><span class="hl--token hl--interpolation"><span class="hl--token hl--punctuation hl--interpolation-punctuation">${</span>trackingId<span class="hl--token hl--punctuation hl--interpolation-punctuation">}</span></span><span class="hl--token hl--string">&l=</span><span class="hl--token hl--interpolation"><span class="hl--token hl--punctuation hl--interpolation-punctuation">${</span>dataLayerName<span class="hl--token hl--punctuation hl--interpolation-punctuation">}</span></span><span class="hl--token hl--string hl--template-punctuation">`</span></span><span class="hl--token hl--punctuation">;</span>
    script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">charset</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">"utf-8"</span><span class="hl--token hl--punctuation">;</span>
    script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">setAttribute</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">"id"</span><span class="hl--token hl--punctuation">,</span> scriptId<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

    head<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">appendChild</span><span class="hl--token hl--punctuation">(</span>script<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

    script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">onload</span> <span class="hl--token hl--operator">=</span> resolve<span class="hl--token hl--punctuation">;</span>
    script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">onerror</span> <span class="hl--token hl--operator">=</span> reject<span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
<span class="hl--token hl--punctuation">}</span>
</code></pre></div>
  </pre> <h3 id=track-the-first-hit-of-your-web-page>Track the first hit of your web page</h3> <p>Google Analytics tracking will happen on the client-side. That means that we must prepare our component tracking to happen only when mounted. Due to it, we will use a flag <code>mounted</code> that will tell if Google Analytics script has mounted successfully in a previous URL.</p> <p>On failure, we will remove the script just in case you want to create some retrying mechanism. Note that by default, Sapper applications ship with a <a href=https://developer.mozilla.org/es/docs/Web/API/Service_Worker_API target=_blank>Service Worker</a> that will have you covered in some cases when the client loses its internet connection. In this case, we are logging the error and removing the script.</p> <pre class=terminal>
  <div class="bar bar-language-javascript">
    <div class=btn></div>
    <div class=bar-title>javascript</div>
    <div><button class="is-small button copy is-pulled-right">Copy</button></div>  
  </div>
  <div class=body><pre class=language-javascript><code><span class="hl--token hl--keyword hl--module">import</span> <span class="hl--token hl--imports"><span class="hl--token hl--punctuation">{</span> onMount <span class="hl--token hl--punctuation">}</span></span> <span class="hl--token hl--keyword hl--module">from</span> <span class="hl--token hl--string">"svelte"</span><span class="hl--token hl--punctuation">;</span>
<span class="hl--token hl--keyword hl--module">export</span> <span class="hl--token hl--keyword">let</span> scriptId <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">"google-analytics-script"</span><span class="hl--token hl--punctuation">;</span>
<span class="hl--token hl--keyword hl--module">export</span> <span class="hl--token hl--keyword">let</span> trackingId <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">"UA-000000-2"</span><span class="hl--token hl--punctuation">;</span>

<span class="hl--token hl--keyword">let</span> mounted <span class="hl--token hl--operator">=</span> <span class="hl--token hl--boolean">false</span><span class="hl--token hl--punctuation">;</span>

<span class="hl--token hl--function">onMount</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--keyword">async</span> <span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--operator hl--arrow">=></span> <span class="hl--token hl--punctuation">{</span>
  <span class="hl--token hl--keyword hl--control-flow">if</span> <span class="hl--token hl--punctuation">(</span><span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">getElementById</span><span class="hl--token hl--punctuation">(</span>scriptId<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
    <span class="hl--token hl--keyword hl--control-flow">return</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--punctuation">}</span>

  <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">dataLayer</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">dataLayer</span> <span class="hl--token hl--operator">||</span> <span class="hl--token hl--punctuation">[</span><span class="hl--token hl--punctuation">]</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method hl--function-variable hl--method-variable">gtag</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--keyword">function</span> <span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
    <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">dataLayer</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">push</span><span class="hl--token hl--punctuation">(</span>arguments<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--function">gtag</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">"js"</span><span class="hl--token hl--punctuation">,</span> <span class="hl--token hl--keyword">new</span> <span class="hl--token hl--class-name">Date</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--function">gtag</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">"config"</span><span class="hl--token hl--punctuation">,</span> trackingId<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

  <span class="hl--token hl--keyword hl--control-flow">try</span> <span class="hl--token hl--punctuation">{</span>
    <span class="hl--token hl--keyword hl--control-flow">await</span> <span class="hl--token hl--function">addGoogleAnalyticsScript</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--punctuation">}</span> <span class="hl--token hl--keyword hl--control-flow">catch</span> <span class="hl--token hl--punctuation">(</span>err<span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
    <span class="hl--token hl--class-name hl--console">console</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">error</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">"gtag failure"</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

    <span class="hl--token hl--keyword">const</span> s <span class="hl--token hl--operator">=</span> <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">getElementById</span><span class="hl--token hl--punctuation">(</span>scriptId<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

    <span class="hl--token hl--keyword hl--control-flow">if</span> <span class="hl--token hl--punctuation">(</span>s<span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
      s<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">remove</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
    <span class="hl--token hl--punctuation">}</span>

    <span class="hl--token hl--keyword hl--control-flow">return</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--punctuation">}</span>

  mounted <span class="hl--token hl--operator">=</span> <span class="hl--token hl--boolean">true</span><span class="hl--token hl--punctuation">;</span>
<span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
</code></pre></div>
  </pre> <h3 id=detecting-page-changes-on-your-sapper-single-page-application>Detecting page changes on your Sapper single page application</h3> <p>The library used to track on Google Analytics is called google tag manager (gtag). During the registration process on GA, you have seen a script that you could inject on your <code>template.html</code> of your sapper application. However, if you do that you won't register pageview events when the user follows a sapper link.</p> <blockquote> <p>Sapper navigation is using the <a href=https://developer.mozilla.org/en-US/docs/Web/API/History target=_blank>History API</a> of your browser. When the user follows a link, the framework picks the assets and preload the missing data. After that, it can render the view without redownloading the full page. That's one of the main benefits of using a Javascript framework with routing capabilities.</p> </blockquote> <p>Sapper is prepared to handle this tracking giving us a <a href=https://sapper.svelte.dev/docs#Stores target=_blank>module</a> that expose the <code>page</code> <a href=https://svelte.dev/docs#svelte_store target=_blank>store</a>. With this simple snippet, you will log the page path on every URL change.</p> <pre class=terminal>
  <div class="bar bar-language-javascript">
    <div class=btn></div>
    <div class=bar-title>javascript</div>
    <div><button class="is-small button copy is-pulled-right">Copy</button></div>  
  </div>
  <div class=body><pre class=language-javascript><code><span class="hl--token hl--keyword hl--module">import</span> <span class="hl--token hl--imports"><span class="hl--token hl--punctuation">{</span> stores <span class="hl--token hl--punctuation">}</span></span> <span class="hl--token hl--keyword hl--module">from</span> <span class="hl--token hl--string">"@sapper/app"</span><span class="hl--token hl--punctuation">;</span>
<span class="hl--token hl--keyword">const</span> <span class="hl--token hl--punctuation">{</span> page <span class="hl--token hl--punctuation">}</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--function">stores</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

$<span class="hl--token hl--operator">:</span> <span class="hl--token hl--punctuation">{</span>
    <span class="hl--token hl--keyword">const</span> page_path <span class="hl--token hl--operator">=</span> $page<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">path</span><span class="hl--token hl--punctuation">;</span>

    <span class="hl--token hl--class-name hl--console">console</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">log</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">{</span> page_path <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>   
<span class="hl--token hl--punctuation">}</span>
</code></pre></div>
  </pre> <p>If we want to send the page view during navigation changes, we can do so really easily just by calling our <code>gtag</code> function, that it's globally available on the window object.</p> <pre class=terminal>
  <div class="bar bar-language-javascript">
    <div class=btn></div>
    <div class=bar-title>javascript</div>
    <div><button class="is-small button copy is-pulled-right">Copy</button></div>  
  </div>
  <div class=body><pre class=language-javascript><code><span class="hl--token hl--keyword hl--module">import</span> <span class="hl--token hl--imports"><span class="hl--token hl--punctuation">{</span> stores <span class="hl--token hl--punctuation">}</span></span> <span class="hl--token hl--keyword hl--module">from</span> <span class="hl--token hl--string">"@sapper/app"</span><span class="hl--token hl--punctuation">;</span>
<span class="hl--token hl--keyword">const</span> <span class="hl--token hl--punctuation">{</span> page <span class="hl--token hl--punctuation">}</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--function">stores</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
<span class="hl--token hl--keyword">let</span> mounted <span class="hl--token hl--operator">=</span> <span class="hl--token hl--boolean">false</span><span class="hl--token hl--punctuation">;</span>

<span class="hl--token hl--comment">// Single page application handling</span>
$<span class="hl--token hl--operator">:</span> <span class="hl--token hl--punctuation">{</span>
  <span class="hl--token hl--keyword">const</span> page_path <span class="hl--token hl--operator">=</span> $page<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">path</span><span class="hl--token hl--punctuation">;</span>

  <span class="hl--token hl--keyword hl--control-flow">if</span> <span class="hl--token hl--punctuation">(</span>mounted <span class="hl--token hl--operator">&&</span> <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">gtag</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
    <span class="hl--token hl--function">gtag</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">"config"</span><span class="hl--token hl--punctuation">,</span> trackingId<span class="hl--token hl--punctuation">,</span> <span class="hl--token hl--punctuation">{</span> page_path <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--punctuation">}</span>
<span class="hl--token hl--punctuation">}</span>
</code></pre></div>
  </pre> <h2 id=google-analytics-svelte-component>Google Analytics svelte component</h2> <p>Combining all the previous parts of the post, we will have a complete svelte component ready to be used on your root <code>_layout.svelte</code>.</p> <pre class=terminal>
  <div class="bar bar-language-html">
    <div class=btn></div>
    <div class=bar-title>html</div>
    <div><button class="is-small button copy is-pulled-right">Copy</button></div>  
  </div>
  <div class=body><pre class=language-html><code><span class="hl--token hl--tag"><span class="hl--token hl--tag"><span class="hl--token hl--punctuation">&lt;</span>script</span><span class="hl--token hl--punctuation">></span></span><span class="hl--token hl--script"><span class="hl--token hl--language-javascript">
  <span class="hl--token hl--keyword hl--module">import</span> <span class="hl--token hl--imports"><span class="hl--token hl--punctuation">{</span> stores <span class="hl--token hl--punctuation">}</span></span> <span class="hl--token hl--keyword hl--module">from</span> <span class="hl--token hl--string">"@sapper/app"</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--keyword hl--module">import</span> <span class="hl--token hl--imports"><span class="hl--token hl--punctuation">{</span> onMount <span class="hl--token hl--punctuation">}</span></span> <span class="hl--token hl--keyword hl--module">from</span> <span class="hl--token hl--string">"svelte"</span><span class="hl--token hl--punctuation">;</span>

  <span class="hl--token hl--comment">// Pass or harcode your google analytics tracking id</span>
  <span class="hl--token hl--keyword hl--module">export</span> <span class="hl--token hl--keyword">let</span> trackingId <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">"UA-000000-2"</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--keyword hl--module">export</span> <span class="hl--token hl--keyword">let</span> scriptId <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">"google-analytics-script"</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--keyword hl--module">export</span> <span class="hl--token hl--keyword">let</span> domain <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">"https://www.googletagmanager.com"</span><span class="hl--token hl--punctuation">;</span>

  <span class="hl--token hl--keyword">let</span> mounted <span class="hl--token hl--operator">=</span> <span class="hl--token hl--boolean">false</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--keyword">const</span> <span class="hl--token hl--punctuation">{</span> page <span class="hl--token hl--punctuation">}</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--function">stores</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

  <span class="hl--token hl--comment">// Adding google tag manager will fail for example if the user is running </span>
  <span class="hl--token hl--comment">// and ad blocker. This Promise can handle that case.</span>
  <span class="hl--token hl--keyword">async</span> <span class="hl--token hl--keyword">function</span> <span class="hl--token hl--function">addGoogleAnalyticsScript</span><span class="hl--token hl--punctuation">(</span>dataLayerName <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">"dataLayer"</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
    <span class="hl--token hl--keyword hl--control-flow">return</span> <span class="hl--token hl--keyword">new</span> <span class="hl--token hl--class-name">Promise</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--parameter">resolve<span class="hl--token hl--punctuation">,</span> reject</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--operator hl--arrow">=></span> <span class="hl--token hl--punctuation">{</span>
      <span class="hl--token hl--keyword">const</span> head <span class="hl--token hl--operator">=</span> <span class="hl--token hl--dom hl--variable">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">head</span> <span class="hl--token hl--operator">||</span> <span class="hl--token hl--dom hl--variable">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">getElementsByTagName</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">"head"</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">[</span><span class="hl--token hl--number">0</span><span class="hl--token hl--punctuation">]</span><span class="hl--token hl--punctuation">;</span>

      <span class="hl--token hl--keyword">const</span> link <span class="hl--token hl--operator">=</span> <span class="hl--token hl--dom hl--variable">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">createElement</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">"link"</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
      link<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">href</span> <span class="hl--token hl--operator">=</span> domain<span class="hl--token hl--punctuation">;</span>
      link<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">rel</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">"preconnect"</span><span class="hl--token hl--punctuation">;</span>
      head<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">appendChild</span><span class="hl--token hl--punctuation">(</span>link<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

      <span class="hl--token hl--keyword">const</span> script <span class="hl--token hl--operator">=</span> <span class="hl--token hl--dom hl--variable">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">createElement</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">"script"</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
      script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">async</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--boolean">true</span><span class="hl--token hl--punctuation">;</span>
      script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">src</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--template-string"><span class="hl--token hl--string hl--template-punctuation">`</span><span class="hl--token hl--interpolation"><span class="hl--token hl--punctuation hl--interpolation-punctuation">${</span>domain<span class="hl--token hl--punctuation hl--interpolation-punctuation">}</span></span><span class="hl--token hl--string">/gtag/js?id=</span><span class="hl--token hl--interpolation"><span class="hl--token hl--punctuation hl--interpolation-punctuation">${</span>trackingId<span class="hl--token hl--punctuation hl--interpolation-punctuation">}</span></span><span class="hl--token hl--string">&l=</span><span class="hl--token hl--interpolation"><span class="hl--token hl--punctuation hl--interpolation-punctuation">${</span>dataLayerName<span class="hl--token hl--punctuation hl--interpolation-punctuation">}</span></span><span class="hl--token hl--string hl--template-punctuation">`</span></span><span class="hl--token hl--punctuation">;</span>
      script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">charset</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--string">"utf-8"</span><span class="hl--token hl--punctuation">;</span>
      script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">setAttribute</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">"id"</span><span class="hl--token hl--punctuation">,</span> scriptId<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

      head<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">appendChild</span><span class="hl--token hl--punctuation">(</span>script<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

      script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">onload</span> <span class="hl--token hl--operator">=</span> resolve<span class="hl--token hl--punctuation">;</span>
      script<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">onerror</span> <span class="hl--token hl--operator">=</span> reject<span class="hl--token hl--punctuation">;</span>
    <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--punctuation">}</span>

  <span class="hl--token hl--function">onMount</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--keyword">async</span> <span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--operator hl--arrow">=></span> <span class="hl--token hl--punctuation">{</span>
    <span class="hl--token hl--comment">// We add the script only once even when the component rendered twice.</span>
    <span class="hl--token hl--keyword hl--control-flow">if</span> <span class="hl--token hl--punctuation">(</span><span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">getElementById</span><span class="hl--token hl--punctuation">(</span>scriptId<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
      <span class="hl--token hl--keyword hl--control-flow">return</span><span class="hl--token hl--punctuation">;</span>
    <span class="hl--token hl--punctuation">}</span>

    <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">dataLayer</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">dataLayer</span> <span class="hl--token hl--operator">||</span> <span class="hl--token hl--punctuation">[</span><span class="hl--token hl--punctuation">]</span><span class="hl--token hl--punctuation">;</span>
    <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method hl--function-variable hl--method-variable">gtag</span> <span class="hl--token hl--operator">=</span> <span class="hl--token hl--keyword">function</span> <span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
      <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">dataLayer</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">push</span><span class="hl--token hl--punctuation">(</span>arguments<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
    <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">;</span>
    <span class="hl--token hl--function">gtag</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">"js"</span><span class="hl--token hl--punctuation">,</span> <span class="hl--token hl--keyword">new</span> <span class="hl--token hl--class-name">Date</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
    <span class="hl--token hl--function">gtag</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">"config"</span><span class="hl--token hl--punctuation">,</span> trackingId<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

    <span class="hl--token hl--keyword hl--control-flow">try</span> <span class="hl--token hl--punctuation">{</span>
      <span class="hl--token hl--keyword hl--control-flow">await</span> <span class="hl--token hl--function">addGoogleAnalyticsScript</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
    <span class="hl--token hl--punctuation">}</span> <span class="hl--token hl--keyword hl--control-flow">catch</span> <span class="hl--token hl--punctuation">(</span>err<span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
      <span class="hl--token hl--class-name hl--console">console</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">error</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">"gtag failure"</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

      <span class="hl--token hl--keyword">const</span> s <span class="hl--token hl--operator">=</span> <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">document</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">getElementById</span><span class="hl--token hl--punctuation">(</span>scriptId<span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

      <span class="hl--token hl--keyword hl--control-flow">if</span> <span class="hl--token hl--punctuation">(</span>s<span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
        s<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access hl--function hl--method">remove</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
      <span class="hl--token hl--punctuation">}</span>

      <span class="hl--token hl--keyword hl--control-flow">return</span><span class="hl--token hl--punctuation">;</span>
    <span class="hl--token hl--punctuation">}</span>

    mounted <span class="hl--token hl--operator">=</span> <span class="hl--token hl--boolean">true</span><span class="hl--token hl--punctuation">;</span>
  <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>

  <span class="hl--token hl--comment">// Single page application handling</span>
  $<span class="hl--token hl--operator">:</span> <span class="hl--token hl--punctuation">{</span>
    <span class="hl--token hl--keyword">const</span> page_path <span class="hl--token hl--operator">=</span> $page<span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">path</span><span class="hl--token hl--punctuation">;</span>

    <span class="hl--token hl--keyword hl--control-flow">if</span> <span class="hl--token hl--punctuation">(</span>mounted <span class="hl--token hl--operator">&&</span> <span class="hl--token hl--dom hl--variable">window</span><span class="hl--token hl--punctuation">.</span><span class="hl--token hl--property-access">gtag</span><span class="hl--token hl--punctuation">)</span> <span class="hl--token hl--punctuation">{</span>
      <span class="hl--token hl--function">gtag</span><span class="hl--token hl--punctuation">(</span><span class="hl--token hl--string">"config"</span><span class="hl--token hl--punctuation">,</span> trackingId<span class="hl--token hl--punctuation">,</span> <span class="hl--token hl--punctuation">{</span> page_path <span class="hl--token hl--punctuation">}</span><span class="hl--token hl--punctuation">)</span><span class="hl--token hl--punctuation">;</span>
    <span class="hl--token hl--punctuation">}</span>
  <span class="hl--token hl--punctuation">}</span>
</span></span><span class="hl--token hl--tag"><span class="hl--token hl--tag"><span class="hl--token hl--punctuation">&lt;/</span>script</span><span class="hl--token hl--punctuation">></span></span>
</code></pre></div>
  </pre> </div> <div class=is-hidden-print><hr> <div><div class=has-text-centered><div><span class="has-text-centered has-text-grey-dark has-text-weight-bold">Share </span></div> <div><a href="https://twitter.com/intent/tweet?url=https://angelblanco.dev/articles/add-gtag-analytics-to-sapper/&text=Add%20Google%20Analytics'%20gtag%20to%20a%20Sapper%20project&via=angelblancodev" class="icon is-medium" target=__blank><i class="fab fa-lg fa-twitter"></i> </a><a href="https://wwww.facebook.com/sharer.php?u=https://angelblanco.dev/articles/add-gtag-analytics-to-sapper/&t=Add%20Google%20Analytics'%20gtag%20to%20a%20Sapper%20project" class="icon is-medium" target=__blank><i class="fab fa-lg fa-facebook"></i> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https://angelblanco.dev/articles/add-gtag-analytics-to-sapper/" class="icon is-medium" target=__blank><i class="fab fa-lg fa-linkedin-in"></i> </a></div></div></div> <div class="svelte-r30y44 columns is-centered mt-3 tiny-letter"><div class="svelte-r30y44 column"><div class="box pb-5 tiny-letter"><div class=content><h4>Subscribe to the newsletter 🚀</h4> <p>Keep up to date with the latest web development posts, at most once a week. </p> </div> <form action=https://tinyletter.com/angelblanco class=fields method=post target=popupwindow><div class="has-addons field"><div class="control is-expanded"><input name=email type=email value="" class=input id=tlemail placeholder="Your email address"></div> <div class=control><button class="is-info button">Subscribe </button></div></div> <input name=embed type=hidden value=1></form> <div class="is-clearfix is-size-7"><a href=https://tinyletter.com class="is-pulled-right has-text-grey-light" target=_blank>powered by TinyLetter </a></div></div></div></div></div></section> <section class="is-hidden-print reading-width section" id=comments><h3 class="title is-3">Comments</h3> <div id=disqus_thread></div></section> <div class="afterArticleContainer svelte-1xs3w5z"></div> </div></main> <footer class="svelte-1yghtac footer info"><hr class="svelte-1yghtac is-hidden-print footerRule"> <div class=has-text-centered><p class="svelte-1yghtac has-text-grey-light is-family-monospace">Personal website of <a href=/about/ class="svelte-1yghtac has-text-grey-dark">Ángel Blanco</a></p> <p class="svelte-1yghtac is-hidden-print footer-github"><a href=https://github.com/angelblanco/angelblanco.dev class="is-small button svelte-1yghtac" target=__blank><span class=icon><span class="fab fa-github"></span></span> <span>Developed by Ángel Blanco hosted on Github</span></a></p> <div class="svelte-1yghtac is-hidden-print is-m-auto libraries-box"><div class=box><p class="svelte-1yghtac has-text-grey-light is-family-monospace">This project <i class="svelte-1yghtac fa-heart fas"></i> this libraries </p> <div class="field is-grouped is-grouped-multiline is-m-auto justify-center"><div class=control><div class="has-addons tags"><span class="tag is-dark">framework</span> <a href=https://sapper.svelte.dev/ class="svelte-1yghtac is-light tag">sapper</a></div> </div><div class=control><div class="has-addons tags"><span class="tag is-dark">css</span> <a href=https://bulma.io/ class="svelte-1yghtac is-light tag">bulma</a></div> </div><div class=control><div class="has-addons tags"><span class="tag is-dark">js</span> <a href=https://svelte.dev/ class="svelte-1yghtac is-light tag">svelte</a></div> </div><div class=control><div class="has-addons tags"><span class="tag is-dark">bundler</span> <a href=https://rollupjs.org/ class="svelte-1yghtac is-light tag">rollup</a></div> </div><div class=control><div class="has-addons tags"><span class="tag is-dark">md</span> <a href=https://github.com/markdown-it/markdown-it class="svelte-1yghtac is-light tag">markdown-it</a></div> </div></div> <p class="svelte-1yghtac has-text-grey-light is-family-monospace is-size-7">And all of <a href=/libraries/ class="svelte-1yghtac has-text-grey-dark has-decoration-underline" rel=preload>these...</a></div></div></div></footer></div> 